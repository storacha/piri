# Setup Piri Node

This section walks you through setting up a Piri node that provides both UCAN and PDP functionality in a single process.

## Prerequisites

Before starting, ensure you have:

1. ‚úÖ [Met system prerequisites](../setup/prerequisites.md)
2. ‚úÖ [Configured and Synced a Lotus Node](../setup/prerequisites.md#filecoin-prerequisites)
3. ‚úÖ [Configured TLS Termination](../setup/tls-termination.md)
4. ‚úÖ [Installed Piri](../setup/installation.md)
5. ‚úÖ [Generated a Key-Pair](../setup/key-generation.md)
6. ‚úÖ [Created a Funded Delegated Wallet](../setup/prerequisites.md#funded-delegated-wallet)

## Initialize Your Piri Node

The `piri init` command handles all the initial setup required to join the Storacha network:
- Imports your wallet
- Creates a proof set (if needed)
- Registers with the storacha network via the delegator service
- Obtains necessary delegations
- Generates a configuration file

### Step 1: Prepare Your Wallet File

Export your delegated Filecoin address to a hex file:

```bash
# Export wallet from Lotus to hex format
lotus wallet export YOUR_DELEGATED_ADDRESS > wallet.hex
```

### Step 2: Run Initialization

Run the `piri init` command with all required parameters. The configuration file is written to stdout while progress messages go to stderr, allowing you to redirect the output directly to a file:

```bash
piri init \
  --data-dir=/path/to/data \
  --temp-dir=/path/to/temp \
  --key-file=/path/to/service.pem \
  --wallet-file=/path/to/wallet.hex \
  --lotus-endpoint=wss://YOUR_LOTUS_ENDPOINT/rpc/v1 \
  --operator-email=your-email@example.com \
  --public-url=https://piri.example.com > config.toml
```

**Parameters:**
- `--data-dir`: Directory for permanent Piri state
- `--temp-dir`: Directory for temporary/ephemeral data
- `--key-file`: Path to your [identity PEM file](../setup/key-generation.md)
- `--wallet-file`: Path to the wallet hex file from Step 1
- `--lotus-endpoint`: WebSocket endpoint of your Lotus node
- `--operator-email`: Your email for Storacha team contact
- `--public-url`: The public HTTPS URL for your Piri node (this should be the domain you configured in the [TLS Termination section](../setup/tls-termination.md), e.g., `https://piri.example.com`)

**Expected Output:**
```bash
üöÄ Initializing your Piri node in the Storacha network...

[1/5] Validating configuration...
‚úÖ Configuration validated

[2/5] Creating Piri node...
‚úÖ Node created with DID: did:key:z6MkhaXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX

[3/5] Setting up proof set...
üìù Creating new proof set...
‚è≥ Waiting for proof set creation to be confirmed on-chain...
   Transaction status: pending
   Transaction status: confirmed
‚úÖ Proof set created with ID: 123

[4/5] Registering with delegator service...
‚úÖ Successfully registered with delegator service
üì• Requesting proof from delegator service...
‚úÖ Received delegator proof

[5/5] Generating configuration file...

üéâ Initialization complete! Your configuration:
```

The command outputs a complete TOML configuration file to stdout. If you didn't redirect the output to a file in the previous step, you can copy and save it now.

## Run Your Piri Node

After successful initialization, run your Piri node using the generated configuration file:

```bash
piri serve full --config=config.toml
```

**Expected Output:**
```bash
‚ñó‚ñÑ‚ñÑ‚ññ ‚ñÑ  ‚ñÑ‚ñÑ‚ñÑ ‚ñÑ   ‚ñó
‚ñê‚ñå ‚ñê‚ñå‚ñÑ ‚ñà    ‚ñÑ   ‚ñà‚ñå
‚ñê‚ñõ‚ñÄ‚ñò ‚ñà ‚ñà    ‚ñà  ‚ñó‚ñà‚ñò
‚ñê‚ñå   ‚ñà      ‚ñà  ‚ñÄ‚ñò

üî• v0.0.12
üÜî did:key:z6MkhaXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
Piri Running on: localhost:3000
Piri Public Endpoint: https://piri.example.com
```

## Understanding the Configuration

The configuration file generated by `piri init` contains all the settings needed to run your node. For a detailed explanation of each configuration option, see the [Configuration Reference](../setup/configuration.md).

## Monitoring and Logs

Piri provides detailed logging of its operations. Monitor the logs to ensure:
- Successful connection to Lotus node
- Proof set operations are working
- UCAN authentication is functioning
- Data uploads are being processed
- Proofs are being generated and submitted

## Troubleshooting

If you encounter issues, the Storacha team is available to help in the [Storacha Discord server](https://discord.gg/pqa6Dn6RnP).

### Initialization Issues

If initialization fails:
1. Verify your Lotus node is synced and accessible
2. Ensure your delegated wallet has sufficient funds
3. Check that your public URL is accessible from the internet
4. Verify DNS is properly configured for your domain

### Runtime Issues

If the server fails to start:
1. Check that port 3000 is available
2. Verify all configuration values are correct
3. Ensure the data and temp directories exist and are writable
4. Check that the wallet was successfully imported during init

---

## Next Steps

After setting up your Piri node:
- [Validate Your Setup](../setup/validation.md)
- Monitor proof generation in the logs
- Check transaction status on chain