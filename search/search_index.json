{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"Getting Started with Piri","text":"<p>This guide covers both the Forge Production and Forge Staging networks. The setup steps are identical except for two values. Use the Environment dropdown in the header to toggle the values shown below (defaults to Production).</p> <p>Getting Started with Piri</p> <p>Pick your environment (Production or Staging) and deploy with the right flags.</p>"},{"location":"#complete-setup-guide","title":"Complete Setup Guide","text":"Step 1 Prerequisites Set up your system, network, and Filecoin node. Step 2 Install Piri Download and install the Piri binary. Step 3 Generate Keys Create your identity key and wallet. Step 4 Configure TLS Set up secure connections (HTTPS) for your domain. Step 5 Setup Piri Node Set up and run your Piri node with environment-aware flags. <p>After following this guide, you will have Piri running and ready to work with the Storacha network.</p>"},{"location":"cli/","title":"CLI Reference","text":"<p>Piri provides a command-line interface for managing storage nodes on the Storacha network.</p>"},{"location":"cli/#usage","title":"Usage","text":"<pre><code>piri [command] [flags]\n</code></pre>"},{"location":"cli/#global-flags","title":"Global Flags","text":"Flag Description <code>--config &lt;path&gt;</code> Config file path. Defaults to <code>~/.config/piri/config.toml</code> <code>--log-level &lt;level&gt;</code> Logging level (debug, info, warn, error) <code>--data-dir &lt;path&gt;</code> Storage service data directory <code>--temp-dir &lt;path&gt;</code> Storage service temp directory <code>--key-file &lt;path&gt;</code> Path to PEM file containing ed25519 private key"},{"location":"cli/#subcommands","title":"Subcommands","text":""},{"location":"cli/#init","title":"init","text":"<p>Initialize a new Piri node.</p>"},{"location":"cli/#serve","title":"serve","text":"<p>Start the Piri server.</p>"},{"location":"cli/#client","title":"client","text":"<p>Interact with a running Piri node.</p>"},{"location":"cli/#wallet","title":"wallet","text":"<p>Manage wallets.</p>"},{"location":"cli/#identity","title":"identity","text":"<p>Generate and manage node identity.</p>"},{"location":"cli/#status","title":"status","text":"<p>Show node status.</p>"},{"location":"cli/#update","title":"update","text":"<p>Check for and apply updates to Piri.</p>"},{"location":"cli/init/","title":"init","text":"<p>Initialize your Piri node and register it with the Storacha network.</p> <p>This is a one-time setup command that prepares your node to participate in the network. It performs several critical operations:</p> <ol> <li>Validates your configuration - Checks that all required files and endpoints are accessible</li> <li>Imports your wallet - Adds your Filecoin delegated address to Piri's wallet for on-chain transactions</li> <li>Creates a proof set - Registers a proof set on the PDP smart contract (this can take up to 5 minutes as it waits for on-chain confirmation)</li> <li>Registers with the network - Signs up your node with the Storacha delegator service and receives authorization proofs</li> <li>Generates a configuration file - Outputs a complete TOML config file that <code>piri serve</code> uses to run your node</li> </ol> <p>After initialization completes, you use the generated config file with <code>piri serve</code> to start your node. You typically only run <code>piri init</code> once per node setup.</p> <p>This command is idempotent - running it multiple times with the same parameters is safe and will reuse existing resources (like your proof set) rather than creating duplicates.</p>"},{"location":"cli/init/#prerequisites","title":"Prerequisites","text":"<p>Before running this command, you need:</p> <ul> <li>A synced Lotus node with ETH RPC enabled</li> <li>A funded delegated wallet exported to hex format</li> <li>An Ed25519 identity key in PEM format (generated with <code>piri identity generate</code>)</li> <li>A domain with TLS configured pointing to your server</li> <li>Directories created for data and temp storage</li> </ul> <p>See the Setup Guide for the complete walkthrough.</p>"},{"location":"cli/init/#usage","title":"Usage","text":"<pre><code>piri init [flags]\n</code></pre>"},{"location":"cli/init/#flags","title":"Flags","text":"<p>All flags are required:</p> Flag Description <code>--network &lt;network&gt;</code> Network to join (<code>forge-prod</code> for mainnet, <code>warm-staging</code> for calibration) <code>--data-dir &lt;path&gt;</code> Directory for permanent Piri data (blobs, database) <code>--temp-dir &lt;path&gt;</code> Directory for temporary data during processing <code>--key-file &lt;path&gt;</code> Path to PEM file containing your Ed25519 identity key <code>--wallet-file &lt;path&gt;</code> Path to hex file containing your delegated Filecoin wallet private key <code>--lotus-endpoint &lt;url&gt;</code> WebSocket URL of your Lotus node (e.g., <code>wss://lotus.example.com/rpc/v1</code>) <code>--operator-email &lt;email&gt;</code> Contact email for the Storacha team to reach you <code>--public-url &lt;url&gt;</code> Public HTTPS URL where your node will be accessible"},{"location":"cli/init/#example","title":"Example","text":"<pre><code>piri init \\\n  --network=forge-prod \\\n  --data-dir=/var/lib/piri/data \\\n  --temp-dir=/var/lib/piri/temp \\\n  --key-file=/etc/piri/service.pem \\\n  --wallet-file=/etc/piri/wallet.hex \\\n  --lotus-endpoint=wss://lotus.example.com/rpc/v1 \\\n  --operator-email=admin@example.com \\\n  --public-url=https://piri.example.com &gt; config.toml\n</code></pre> <pre><code>Initializing your Piri node on the Storacha Network...\n\n[1/5] Validating configuration...\nConfiguration validated\n\n[2/5] Creating Piri node...\nNode created with DID: did:key:z6MkhaXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX\n\n[3/5] Setting up proof set...\nCreating new proof set...\nWaiting for proof set creation to be confirmed on-chain...\nProof set created with ID: 123\n\n[4/5] Registering with delegator service...\nSuccessfully registered with delegator service\nReceived delegator proof\n\n[5/5] Generating configuration file...\n\nInitialization complete!\n</code></pre> <p>The config file is written to stdout. Use <code>&gt; config.toml</code> to save it to a file, or place it directly in <code>~/.config/piri/config.toml</code> for automatic loading by <code>piri serve</code>.</p>"},{"location":"cli/init/#whats-next","title":"What's Next","text":"<p>After initialization, start your node:</p> <pre><code>piri serve --config=config.toml\n</code></pre> <p>See <code>piri serve</code> for details on running the server.</p>"},{"location":"cli/update/","title":"update","text":"<p>Check for and apply updates to Piri.</p>"},{"location":"cli/update/#usage","title":"Usage","text":"<pre><code>piri update [flags]\n</code></pre>"},{"location":"cli/update/#flags","title":"Flags","text":"Flag Description <code>--check</code> Check for updates without applying them <code>--force</code> Skip safety checks and force update <code>--version &lt;version&gt;</code> Update to a specific version (e.g., v1.2.3)"},{"location":"cli/update/#example","title":"Example","text":"<pre><code>piri update\n</code></pre> <pre><code>Current version: v0.2.1\nLatest version:  v0.2.2\nDownloading v0.2.2...\nUpdate complete. Restart the service to apply changes.\n</code></pre> <p>This command downloads and installs the latest version but does not restart the service. Use <code>piri status upgrade-check</code> first to verify it's safe to update.</p>"},{"location":"cli/client/","title":"client","text":"<p>Interact with a running Piri node.</p> <p>All client commands require a running Piri server and authenticate using JWT tokens signed with your node's identity key. Pass the same <code>--config</code> file you used with <code>piri serve</code> - this provides both the server address and your identity key for authentication:</p> <pre><code>piri --config=config.toml client admin config list\n</code></pre>"},{"location":"cli/client/#usage","title":"Usage","text":"<pre><code>piri client [command] [flags]\n</code></pre>"},{"location":"cli/client/#flags","title":"Flags","text":"Flag Description Default <code>--node-url &lt;url&gt;</code> URL of a Piri node <code>http://localhost:3000</code>"},{"location":"cli/client/#subcommands","title":"Subcommands","text":""},{"location":"cli/client/#admin","title":"admin","text":"<p>Administrative operations (logs, config).</p>"},{"location":"cli/client/#pdp","title":"pdp","text":"<p>PDP (Provable Data Possession) operations.</p>"},{"location":"cli/client/admin/","title":"admin","text":"<p>Administrative operations for managing a running Piri node.</p>"},{"location":"cli/client/admin/#usage","title":"Usage","text":"<pre><code>piri client admin [command]\n</code></pre>"},{"location":"cli/client/admin/#subcommands","title":"Subcommands","text":""},{"location":"cli/client/admin/#config","title":"config","text":"<p>Manage dynamic configuration.</p>"},{"location":"cli/client/admin/#log","title":"log","text":"<p>Manage logging levels.</p>"},{"location":"cli/client/admin/config/","title":"config","text":"<p>Manage dynamic configuration values at runtime.</p>"},{"location":"cli/client/admin/config/#how-it-works","title":"How It Works","text":"<p>The config file is the source of truth. Runtime changes are ephemeral by default\u2014they override behavior without touching the file. A reload restores the file's authority. The <code>--persist</code> flag exists for operators who mean it: change the behavior and update the file so the two agree.</p> <p>This prevents the most common configuration surprise: a system whose running state has silently diverged from its config file, discovered during a restart nobody planned for.</p> <p>Example workflow:</p> <p>A Piri node starts with this config file:</p> <pre><code>[pdp.aggregation.manager]\npoll_interval = \"30s\"\n</code></pre> <p>The node uses a poll interval of 30 seconds.</p> <p>Runtime override (ephemeral):</p> <pre><code>piri client admin config set pdp.aggregation.manager.poll_interval 5m\n</code></pre> <p>The node now uses 5 minutes. The config file is unchanged.</p> <p>Reload from file:</p> <pre><code>piri client admin config reload\n</code></pre> <p>The node returns to 30 seconds. The file wins; runtime overrides do not survive a reload.</p> <p>Edit the file, then reload:</p> <pre><code>[pdp.aggregation.manager]\npoll_interval = \"5m\"\n</code></pre> <pre><code>piri client admin config reload\n</code></pre> <p>The node uses 5 minutes. The file still wins\u2014it just agrees with you now.</p> <p>Runtime override with <code>--persist</code>:</p> <pre><code>piri client admin config set pdp.aggregation.manager.poll_interval 10m --persist\n</code></pre> <p>The node uses 10 minutes and the config file is updated to match. Future reloads will preserve the change.</p>"},{"location":"cli/client/admin/config/#usage","title":"Usage","text":"<pre><code>piri client admin config [command]\n</code></pre>"},{"location":"cli/client/admin/config/#subcommands","title":"Subcommands","text":""},{"location":"cli/client/admin/config/#list","title":"list","text":"<p>List all dynamic configuration values.</p>"},{"location":"cli/client/admin/config/#get","title":"get","text":"<p>Get a specific configuration value.</p>"},{"location":"cli/client/admin/config/#set","title":"set","text":"<p>Set a configuration value.</p>"},{"location":"cli/client/admin/config/#reload","title":"reload","text":"<p>Reload configuration from file.</p>"},{"location":"cli/client/admin/config/get/","title":"get","text":"<p>Get the current runtime value of a dynamic configuration key.</p> <p>This is the value Piri is using right now, which may differ from the config file if a runtime override has been applied via <code>set</code>.</p>"},{"location":"cli/client/admin/config/get/#usage","title":"Usage","text":"<pre><code>piri client admin config get &lt;key&gt;\n</code></pre>"},{"location":"cli/client/admin/config/get/#arguments","title":"Arguments","text":"Argument Description <code>&lt;key&gt;</code> The configuration key to retrieve"},{"location":"cli/client/admin/config/get/#example","title":"Example","text":"<pre><code>piri client admin config get pdp.aggregation.manager.poll_interval\n</code></pre> <pre><code>30s\n</code></pre> <p>See Dynamic Configuration for the list of available keys.</p>"},{"location":"cli/client/admin/config/list/","title":"list","text":"<p>List the current runtime values of all dynamic configuration keys.</p> <p>These are the values Piri is using right now. They may differ from the config file if runtime overrides have been applied via <code>set</code>.</p>"},{"location":"cli/client/admin/config/list/#usage","title":"Usage","text":"<pre><code>piri client admin config list\n</code></pre>"},{"location":"cli/client/admin/config/list/#example","title":"Example","text":"<pre><code>piri client admin config list\n</code></pre> <pre><code>{\n  \"pdp.aggregation.manager.batch_size\": 10,\n  \"pdp.aggregation.manager.poll_interval\": \"30s\"\n}\n</code></pre> <p>See Dynamic Configuration for the list of available keys.</p>"},{"location":"cli/client/admin/config/reload/","title":"reload","text":"<p>Reload configuration from the config file.</p>"},{"location":"cli/client/admin/config/reload/#usage","title":"Usage","text":"<pre><code>piri client admin config reload\n</code></pre>"},{"location":"cli/client/admin/config/reload/#example","title":"Example","text":"<pre><code>piri client admin config reload\n</code></pre> <pre><code>Configuration reloaded from file\n{\n  \"pdp.aggregation.manager.batch_size\": 10,\n  \"pdp.aggregation.manager.poll_interval\": \"1m0s\"\n}\n</code></pre> <p>See Dynamic Configuration for the list of available keys.</p>"},{"location":"cli/client/admin/config/set/","title":"set","text":"<p>Set a dynamic configuration value.</p>"},{"location":"cli/client/admin/config/set/#usage","title":"Usage","text":"<pre><code>piri client admin config set &lt;key&gt; &lt;value&gt; [flags]\n</code></pre>"},{"location":"cli/client/admin/config/set/#arguments","title":"Arguments","text":"Argument Description <code>&lt;key&gt;</code> The configuration key to set <code>&lt;value&gt;</code> The new value"},{"location":"cli/client/admin/config/set/#flags","title":"Flags","text":"Flag Description <code>--persist</code> Persist the change to the config file"},{"location":"cli/client/admin/config/set/#example","title":"Example","text":"<pre><code>piri client admin config set pdp.aggregation.manager.poll_interval 1m\n</code></pre> <pre><code>pdp.aggregation.manager.poll_interval updated\n</code></pre> <p>See Dynamic Configuration for the list of available keys.</p>"},{"location":"cli/client/admin/log/","title":"log","text":"<p>Manage logging levels for a running Piri node.</p>"},{"location":"cli/client/admin/log/#usage","title":"Usage","text":"<pre><code>piri client admin log [command]\n</code></pre>"},{"location":"cli/client/admin/log/#subcommands","title":"Subcommands","text":""},{"location":"cli/client/admin/log/#list","title":"list","text":"<p>List all log systems and their current levels.</p>"},{"location":"cli/client/admin/log/#set","title":"set","text":"<p>Set a log level for one system or all systems.</p>"},{"location":"cli/client/admin/log/#set-regex","title":"set-regex","text":"<p>Set log level for subsystems matching a regex pattern.</p>"},{"location":"cli/client/admin/log/list/","title":"list","text":"<p>List all log systems and their current levels.</p>"},{"location":"cli/client/admin/log/list/#usage","title":"Usage","text":"<pre><code>piri client admin log list\n</code></pre>"},{"location":"cli/client/admin/log/list/#example","title":"Example","text":"<pre><code>piri client admin log list\n</code></pre> <pre><code>{\n  \"piri/pdp\": \"info\",\n  \"piri/storage\": \"info\",\n  \"piri/retrieval\": \"debug\",\n  \"piri/claims\": \"info\",\n  \"piri/replicator\": \"warn\"\n}\n</code></pre>"},{"location":"cli/client/admin/log/set-regex/","title":"set-regex","text":"<p>Set log level for subsystems matching a regex pattern.</p>"},{"location":"cli/client/admin/log/set-regex/#usage","title":"Usage","text":"<pre><code>piri client admin log set-regex &lt;level&gt; &lt;expression&gt;\n</code></pre>"},{"location":"cli/client/admin/log/set-regex/#arguments","title":"Arguments","text":"Argument Description <code>&lt;level&gt;</code> Log level to set (debug, info, warn, error) <code>&lt;expression&gt;</code> Regular expression pattern to match system names"},{"location":"cli/client/admin/log/set-regex/#example","title":"Example","text":"<pre><code>piri client admin log set-regex debug \"piri/pdp.*\"\n</code></pre> <pre><code>{\n  \"piri/pdp\": \"debug\",\n  \"piri/pdp/scheduler\": \"debug\",\n  \"piri/pdp/aggregation\": \"debug\"\n}\n</code></pre>"},{"location":"cli/client/admin/log/set/","title":"set","text":"<p>Set a log level for one system or all systems.</p>"},{"location":"cli/client/admin/log/set/#usage","title":"Usage","text":"<pre><code>piri client admin log set &lt;level&gt; [system]\n</code></pre>"},{"location":"cli/client/admin/log/set/#arguments","title":"Arguments","text":"Argument Description <code>&lt;level&gt;</code> Log level to set (debug, info, warn, error) <code>[system]</code> Specific system name. If omitted, sets level for all systems"},{"location":"cli/client/admin/log/set/#example","title":"Example","text":"<pre><code>piri client admin log set debug piri/pdp\n</code></pre> <pre><code>{\n  \"piri/pdp\": \"debug\"\n}\n</code></pre>"},{"location":"cli/client/pdp/","title":"pdp","text":"<p>PDP (Provable Data Possession) operations.</p>"},{"location":"cli/client/pdp/#usage","title":"Usage","text":"<pre><code>piri client pdp [command]\n</code></pre>"},{"location":"cli/client/pdp/#subcommands","title":"Subcommands","text":""},{"location":"cli/client/pdp/#proofset","title":"proofset","text":"<p>Manage proof sets.</p>"},{"location":"cli/client/pdp/proofset/","title":"proofset","text":"<p>Manage proof sets.</p>"},{"location":"cli/client/pdp/proofset/#usage","title":"Usage","text":"<pre><code>piri client pdp proofset [command]\n</code></pre>"},{"location":"cli/client/pdp/proofset/#subcommands","title":"Subcommands","text":""},{"location":"cli/client/pdp/proofset/#state","title":"state","text":"<p>Get the current state of a proof set.</p>"},{"location":"cli/client/pdp/proofset/state/","title":"state","text":"<p>Get the current state of a proof set.</p>"},{"location":"cli/client/pdp/proofset/state/#usage","title":"Usage","text":"<pre><code>piri client pdp proofset state [flags]\n</code></pre>"},{"location":"cli/client/pdp/proofset/state/#flags","title":"Flags","text":"Flag Description <code>--proof-set &lt;id&gt;</code> The proof set ID to query <code>--json</code> Output in JSON format"},{"location":"cli/client/pdp/proofset/state/#example","title":"Example","text":"<pre><code>piri client pdp proofset state --proof-set 123\n</code></pre> <pre><code>Proof Set State\n===============\nProof Set ID:        123\nProving Period:      2880 epochs\nChallenge Window:    60 epochs\n\nOwners\n------\nOwner:               0x1234...abcd\n\nStatus\n------\nInitialized:         true\nCurrent Epoch:       4052160\n\nChallenge State\n---------------\nIn Challenge Window: false\nHas Proven:          true\nNext Challenge:      2025-01-28 14:30:00 UTC (estimated)\n\nOn-Chain State\n--------------\nRoot Count:          42\nTotal Data Size:     1.2 TiB\n</code></pre>"},{"location":"cli/identity/","title":"identity","text":"<p>Generate and manage Ed25519 keys for decentralized identities (DIDs).</p>"},{"location":"cli/identity/#usage","title":"Usage","text":"<pre><code>piri identity [command]\n</code></pre>"},{"location":"cli/identity/#aliases","title":"Aliases","text":"<ul> <li><code>id</code></li> </ul>"},{"location":"cli/identity/#subcommands","title":"Subcommands","text":""},{"location":"cli/identity/#generate","title":"generate","text":"<p>Generate a new PEM-encoded Ed25519 key pair.</p>"},{"location":"cli/identity/#parse","title":"parse","text":"<p>Parse a DID from a PEM file.</p>"},{"location":"cli/identity/generate/","title":"generate","text":"<p>Generate a new PEM-encoded Ed25519 key pair for use with decentralized identities (DIDs).</p>"},{"location":"cli/identity/generate/#usage","title":"Usage","text":"<pre><code>piri identity generate\n</code></pre>"},{"location":"cli/identity/generate/#aliases","title":"Aliases","text":"<ul> <li><code>gen</code></li> </ul>"},{"location":"cli/identity/generate/#example","title":"Example","text":"<pre><code>piri identity generate &gt; my-key.pem\n</code></pre> <pre><code># did:key:z6MkhaXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX\n</code></pre> <p>The PEM-encoded key is written to stdout and can be redirected to a file. The DID is printed to stderr as a comment for convenience.</p>"},{"location":"cli/identity/parse/","title":"parse","text":"<p>Parse a DID from a PEM file containing an Ed25519 key.</p>"},{"location":"cli/identity/parse/#usage","title":"Usage","text":"<pre><code>piri identity parse &lt;pem-file&gt;\n</code></pre>"},{"location":"cli/identity/parse/#arguments","title":"Arguments","text":"Argument Description <code>&lt;pem-file&gt;</code> Path to PEM file containing Ed25519 private key"},{"location":"cli/identity/parse/#example","title":"Example","text":"<pre><code>piri identity parse my-key.pem\n</code></pre> <pre><code># did:key:z6MkhaXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX\n</code></pre>"},{"location":"cli/serve/","title":"serve","text":"<p>Start the Piri server and begin participating in the Storacha network.</p> <p>This is a long-running process that operates your storage node. Once started, Piri will:</p> <ol> <li>Accept storage requests - Receive and store data from clients via the UCAN protocol</li> <li>Generate PDP proofs - Create Provable Data Possession proofs on a regular schedule to demonstrate you're storing data correctly</li> <li>Respond to challenges - Submit proofs to the on-chain PDP smart contract during challenge windows</li> <li>Publish to IPNI - Announce stored content to the InterPlanetary Network Indexer for discoverability</li> <li>Handle retrievals - Serve stored data back to clients on request</li> </ol> <p>The server runs continuously, writing logs to the terminal. For production deployments, you should run it as a systemd service or use a process manager to ensure it restarts on failure.</p>"},{"location":"cli/serve/#prerequisites","title":"Prerequisites","text":"<p>Before running this command:</p> <ol> <li>Run <code>piri init</code> to generate a configuration file - this registers your node with the network and creates your proof set</li> <li>Ensure your TLS reverse proxy is running (Nginx with SSL certificates)</li> <li>Verify your Lotus node is synced and accessible</li> </ol>"},{"location":"cli/serve/#configuration","title":"Configuration","text":"<p>The server reads its configuration from a TOML file generated by <code>piri init</code>. You can specify the config file path with <code>--config</code>, or place it in the default location (<code>~/.config/piri/config.toml</code>) for automatic loading.</p> <p>Most flags below are already set in your config file - you typically only need <code>--config</code> to start the server. See the Configuration docs for details on all available settings.</p>"},{"location":"cli/serve/#usage","title":"Usage","text":"<pre><code>piri serve [flags]\n</code></pre>"},{"location":"cli/serve/#flags","title":"Flags","text":"Flag Description Default <code>--config &lt;path&gt;</code> Path to configuration file <code>~/.config/piri/config.toml</code> <code>--host &lt;host&gt;</code> Host to listen on <code>localhost</code> <code>--port &lt;port&gt;</code> Port to listen on <code>3000</code> <code>--public-url &lt;url&gt;</code> URL the node is publicly accessible at <code>--network &lt;network&gt;</code> Network the node operates on <code>--proof-set &lt;id&gt;</code> Proof set ID to use with PDP <code>--lotus-url &lt;url&gt;</code> WebSocket URL for Lotus node <code>--owner-address &lt;address&gt;</code> Ethereum address to submit PDP proofs with (must be in piri wallet)"},{"location":"cli/serve/#example","title":"Example","text":"<pre><code>piri serve --config=config.toml\n</code></pre> <pre><code>\u2597\u2584\u2584\u2596 \u2584  \u2584\u2584\u2584 \u2584   \u2597\n\u2590\u258c \u2590\u258c\u2584 \u2588    \u2584   \u2588\u258c\n\u2590\u259b\u2580\u2598 \u2588 \u2588    \u2588  \u2597\u2588\u2598\n\u2590\u258c   \u2588      \u2588  \u2580\u2598\n\nv0.2.1\ndid:key:z6MkhaXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX\nPiri Running on: localhost:3000\nPiri Public Endpoint: https://piri.example.com\n</code></pre>"},{"location":"cli/serve/#stopping-the-server","title":"Stopping the Server","text":"<p>Use <code>Ctrl+C</code> to gracefully stop the server. On shutdown, Piri will:</p> <ul> <li>Wait for any active retrievals to finish</li> <li>Wait for any in-progress chain tasks (proving, message sends) to complete</li> <li>Force stop after 1 minute if tasks haven't completed</li> </ul> <p>Before stopping for maintenance or upgrades, check if it's safe using <code>piri status</code> to ensure you're not in the middle of a challenge window.</p> <p>See the Setup Guide for complete setup instructions and the Upgrading guide for safe update procedures.</p>"},{"location":"cli/status/","title":"status","text":"<p>Check node status and health.</p> <p>This command requires a running Piri server. Pass the same <code>--config</code> file you used with <code>piri serve</code> so the command knows where to connect:</p> <pre><code>piri --config=config.toml status\n</code></pre> <p>This command provides a quick overview of your node's current state, including whether it's healthy, in a challenge window, and safe to update. For more detailed information about your proof set (challenge timing, on-chain state, fee information), use <code>piri client pdp proofset state</code>.</p>"},{"location":"cli/status/#usage","title":"Usage","text":"<pre><code>piri status [command] [flags]\n</code></pre>"},{"location":"cli/status/#flags","title":"Flags","text":"Flag Description <code>--json</code> Output in JSON format"},{"location":"cli/status/#subcommands","title":"Subcommands","text":""},{"location":"cli/status/#upgrade-check","title":"upgrade-check","text":"<p>Check if it's safe to upgrade the node.</p>"},{"location":"cli/status/#example","title":"Example","text":"<pre><code>piri status\n</code></pre> <pre><code>Node Status\n===========\nHealthy:           YES\nCurrently Proving: NO\nIn Challenge:      NO\nHas Proven:        YES\nIn Fault State:    NO\nSafe to Update:    YES\nNext Challenge:    2025-01-28 14:30:00 UTC\n</code></pre>"},{"location":"cli/status/upgrade-check/","title":"upgrade-check","text":"<p>Check if it's safe to upgrade the node.</p>"},{"location":"cli/status/upgrade-check/#usage","title":"Usage","text":"<pre><code>piri status upgrade-check\n</code></pre>"},{"location":"cli/status/upgrade-check/#exit-codes","title":"Exit Codes","text":"Code Meaning <code>0</code> Safe to upgrade <code>1</code> Not safe to upgrade <code>2</code> Unable to determine status"},{"location":"cli/status/upgrade-check/#example","title":"Example","text":"<pre><code>piri status upgrade-check &amp;&amp; piri update\n</code></pre> <pre><code>Safe to upgrade\n</code></pre> <p>This command is designed for use in scripts and automation. It returns exit codes to indicate whether an upgrade can safely proceed without interrupting proof generation.</p>"},{"location":"cli/wallet/","title":"wallet","text":"<p>Manage wallet addresses.</p>"},{"location":"cli/wallet/#usage","title":"Usage","text":"<pre><code>piri wallet [command]\n</code></pre>"},{"location":"cli/wallet/#subcommands","title":"Subcommands","text":""},{"location":"cli/wallet/#list","title":"list","text":"<p>List all wallet addresses.</p>"},{"location":"cli/wallet/#import","title":"import","text":"<p>Import an address to the wallet.</p> <p>You must import a wallet before you can start a Piri node. The wallet is used as the owner address for submitting PDP proofs to the blockchain.</p>"},{"location":"cli/wallet/import/","title":"import","text":"<p>Import an address to the wallet.</p>"},{"location":"cli/wallet/import/#usage","title":"Usage","text":"<pre><code>piri wallet import &lt;wallet-file&gt;\n</code></pre>"},{"location":"cli/wallet/import/#arguments","title":"Arguments","text":"Argument Description <code>&lt;wallet-file&gt;</code> Path to a file containing a delegated Filecoin address private key in hex format"},{"location":"cli/wallet/import/#example","title":"Example","text":"<pre><code>piri wallet import wallet.hex\n</code></pre> <pre><code>imported wallet f410fxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx successfully!\n</code></pre> <p>To create a wallet file using Lotus:</p> <pre><code>lotus wallet new delegated\nlotus wallet export &lt;FILECOIN_ADDRESS&gt; &gt; wallet.hex\n</code></pre> <p>The wallet must be imported before running <code>piri init</code> or <code>piri serve</code>.</p>"},{"location":"cli/wallet/list/","title":"list","text":"<p>List all wallet addresses.</p>"},{"location":"cli/wallet/list/#usage","title":"Usage","text":"<pre><code>piri wallet list\n</code></pre>"},{"location":"cli/wallet/list/#example","title":"Example","text":"<pre><code>piri wallet list\n</code></pre> <pre><code>Address: f410fxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx\n</code></pre>"},{"location":"concepts/","title":"Concepts","text":"<p>Understanding how Piri works internally.</p> <p>This section covers the architectural concepts and design decisions behind Piri's components.</p>"},{"location":"concepts/#topics","title":"Topics","text":""},{"location":"concepts/#database","title":"Database","text":"<p>How Piri uses databases for operational state, the difference between SQLite and PostgreSQL backends, and guidance on choosing the right backend for your deployment.</p>"},{"location":"concepts/#networks","title":"Networks","text":"<p>Storacha networks that Piri operates on, including service endpoints, smart contract addresses, and chain configuration.</p>"},{"location":"concepts/#telemetry","title":"Telemetry","text":"<p>OpenTelemetry-based observability: metrics and traces emitted by Piri, and how to integrate with your monitoring infrastructure.</p>"},{"location":"concepts/database/","title":"Database","text":"<p>Piri uses databases to manage operational state, job queues, and task scheduling. This page explains the database architecture and helps you choose the right backend for your deployment.</p>"},{"location":"concepts/database/#logical-databases","title":"Logical Databases","text":"<p>Piri maintains four logical databases, each serving a distinct purpose:</p> Database Purpose Scheduler Task engine state and PDP proof scheduling Replicator Data replication job tracking Aggregator CommP hash aggregation job queue Egress Tracker Data egress operation tracking"},{"location":"concepts/database/#sqlite-mode-default","title":"SQLite Mode (Default)","text":"<p>SQLite is the default database backend, requiring no additional configuration.</p>"},{"location":"concepts/database/#file-locations","title":"File Locations","text":"<p>When using SQLite, Piri creates separate database files under your configured <code>data_dir</code>:</p> <pre><code>{data_dir}/\n\u251c\u2500\u2500 replicator/\n\u2502   \u2514\u2500\u2500 replicator.db\n\u251c\u2500\u2500 pdp/\n\u2502   \u2514\u2500\u2500 state/\n\u2502       \u2514\u2500\u2500 state.db\n\u251c\u2500\u2500 aggregator/\n\u2502   \u2514\u2500\u2500 jobqueue/\n\u2502       \u2514\u2500\u2500 jobqueue.db\n\u2514\u2500\u2500 egress_tracker/\n    \u2514\u2500\u2500 jobqueue/\n        \u2514\u2500\u2500 jobqueue.db\n</code></pre>"},{"location":"concepts/database/#characteristics","title":"Characteristics","text":"<ul> <li>Write-Ahead Logging (WAL): Enables concurrent read access while writing</li> <li>Single Writer: SQLite only supports one writer at a time (1 connection per database)</li> <li>Zero Configuration: Works out of the box with just <code>data_dir</code> set</li> </ul>"},{"location":"concepts/database/#postgresql-mode","title":"PostgreSQL Mode","text":"<p>PostgreSQL mode uses a single database instance with separate schemas for each logical database.</p>"},{"location":"concepts/database/#schema-layout","title":"Schema Layout","text":"<p>All four logical databases share one PostgreSQL database, isolated by schema:</p> <ul> <li><code>replicator</code> schema</li> <li><code>scheduler</code> schema</li> <li><code>aggregator</code> schema</li> <li><code>egress_tracker</code> schema</li> </ul>"},{"location":"concepts/database/#characteristics_1","title":"Characteristics","text":"<ul> <li>Connection Pooling: Configurable max connections and idle pool size</li> <li>Concurrent Writers: Supports multiple simultaneous writers</li> <li>External Management: Database runs separately from Piri</li> </ul>"},{"location":"concepts/database/#configuration","title":"Configuration","text":"<p>See Database Configuration for PostgreSQL setup.</p>"},{"location":"concepts/database/#choosing-a-backend","title":"Choosing a Backend","text":"Consideration SQLite PostgreSQL Setup complexity None Requires external database Concurrent writers Single Multiple Scaling Single node Multiple Piri instances Operational overhead Low Higher Backup strategy File copy Database dumps <p>Recommended:</p> <ul> <li>SQLite: Development, testing, single-node deployments</li> <li>PostgreSQL: Production environments, high availability requirements, multiple Piri instances sharing state</li> </ul>"},{"location":"concepts/database/#backend-switching","title":"Backend Switching","text":"<p>Warning: You cannot switch database backends after initial setup. There is no migration path between SQLite and PostgreSQL.</p> <p>Choose your database backend before storing any data. If you need to switch backends later, you must start with a fresh Piri installation.</p>"},{"location":"concepts/networks/","title":"Networks","text":"<p>Piri operates on Storacha networks, which define the services and smart contracts it communicates with.</p>"},{"location":"concepts/networks/#forge-prod","title":"forge-prod","text":"<p>Production network on Filecoin Mainnet.</p> <p>Chain ID: 314</p>"},{"location":"concepts/networks/#services","title":"Services","text":"Service URL DID Upload <code>https://up.forge.storacha.network</code> <code>did:web:up.forge.storacha.network</code> Indexing <code>https://indexer.forge.storacha.network</code> <code>did:web:indexer.forge.storacha.network</code> Egress Tracker <code>https://etracker.forge.storacha.network</code> <code>did:web:etracker.forge.storacha.network</code> Signing <code>https://signer.forge.storacha.network</code> <code>did:web:signer.forge.storacha.network</code> Registrar <code>https://registrar.forge.storacha.network</code> - IPNI <code>https://ipni.forge.storacha.network</code> -"},{"location":"concepts/networks/#smart-contracts","title":"Smart Contracts","text":"Contract Address PDP Verifier <code>0xBADd0B92C1c71d02E7d520f64c0876538fa2557F</code> Provider Registry <code>0xf55dDbf63F1b55c3F1D4FA7e339a68AB7b64A5eB</code> PDP Service <code>0x56e53c5e7F27504b810494cc3b88b2aa0645a839</code> PDP Service View <code>0x778Bbb8F50d759e2AA03ab6FAEF830Ca329AFF9D</code> Payments <code>0x23b1e018F08BB982348b15a86ee926eEBf7F4DAa</code> USDFC Token <code>0x80B98d3aa09ffff255c3ba4A241111Ff1262F045</code> <p>Payer Address (Storacha) : <code>0x3c1ae7a70a2b51458fcb7927fd77aae408a1b857</code></p>"},{"location":"concepts/networks/#warm-staging","title":"warm-staging","text":"<p>Staging network on Filecoin Calibration testnet. Use this for testing before deploying to production.</p> <p>Chain ID: 314159</p>"},{"location":"concepts/networks/#services_1","title":"Services","text":"Service URL DID Upload <code>https://staging.up.warm.storacha.network</code> <code>did:web:staging.up.warm.storacha.network</code> Indexing <code>https://staging.indexer.warm.storacha.network</code> <code>did:web:staging.indexer.warm.storacha.network</code> Egress Tracker <code>https://staging.etracker.warm.storacha.network</code> <code>did:web:staging.etracker.warm.storacha.network</code> Signing <code>https://staging.signer.warm.storacha.network</code> <code>did:web:staging.signer.warm.storacha.network</code> Registrar <code>https://staging.registrar.warm.storacha.network</code> - IPNI <code>https://staging.ipni.warm.storacha.network</code> -"},{"location":"concepts/networks/#smart-contracts_1","title":"Smart Contracts","text":"Contract Address PDP Verifier <code>0x85e366Cf9DD2c0aE37E963d9556F5f4718d6417C</code> Provider Registry <code>0x6A96aaB210B75ee733f0A291B5D8d4A053643979</code> PDP Service <code>0x0c6875983B20901a7C3c86871f43FdEE77946424</code> PDP Service View <code>0xEAD67d775f36D1d2894854D20e042C77A3CC20a5</code> Payments <code>0x09a0fDc2723fAd1A7b8e3e00eE5DF73841df55a0</code> USDFC Token <code>0xb3042734b608a1B16e9e86B374A3f3e389B4cDf0</code> <p>Payer Address (Storacha): <code>0x8d3d7cE4F43607C9d0ac01f695c7A9caC135f9AD</code></p>"},{"location":"concepts/telemetry/","title":"Telemetry","text":"<p>Piri uses OpenTelemetry to emit metrics and traces for observability. You can configure custom collectors to send this data to your own monitoring infrastructure.</p>"},{"location":"concepts/telemetry/#metrics","title":"Metrics","text":"<p>Piri emits metrics via OTLP (OpenTelemetry Protocol) that can be consumed by any compatible collector.</p>"},{"location":"concepts/telemetry/#host-metrics","title":"Host Metrics","text":"<p>System-level metrics for monitoring node health:</p> Metric Type Unit Description <code>system_cpu_utilization</code> Gauge 0-1 System-wide CPU utilization <code>system_memory_used_bytes</code> Gauge bytes System memory in use <code>system_memory_total_bytes</code> Gauge bytes Total system memory <code>piri_datadir_used_bytes</code> Gauge bytes Disk space used by data directory <code>piri_datadir_free_bytes</code> Gauge bytes Free disk space for data directory <code>piri_datadir_total_bytes</code> Gauge bytes Total disk space for data directory"},{"location":"concepts/telemetry/#job-queue-metrics","title":"Job Queue Metrics","text":"<p>Track task execution in internal job queues:</p> Metric Type Description <code>active_jobs</code> UpDownCounter Currently running jobs <code>queued_jobs</code> UpDownCounter Jobs waiting in queue <code>failed_jobs</code> Counter Permanently failed jobs <code>job_duration</code> Histogram Job execution duration (seconds) <p>Labels:</p> Label Description <code>queue</code> Name of the job queue (e.g., <code>replicator</code>, <code>aggregator</code>, <code>egress_tracker</code>) <code>job</code> Type of job being executed <code>status</code> Job outcome (<code>success</code> or <code>failure</code>) <code>attempt</code> Retry attempt number (1-based) <code>failure_reason</code> Reason for permanent failure (only on <code>failed_jobs</code>)"},{"location":"concepts/telemetry/#http-server-metrics","title":"HTTP Server Metrics","text":"<p>Standard OpenTelemetry HTTP instrumentation:</p> Metric Type Description <code>http.server.request.duration</code> Histogram Request latency <code>http.server.request.body.size</code> Histogram Request body size <code>http.server.response.body.size</code> Histogram Response body size"},{"location":"concepts/telemetry/#pdp-metrics","title":"PDP Metrics","text":"<p>Provable Data Possession task metrics:</p> Metric Type Description <code>chain_current_epoch</code> Gauge Current Filecoin chain epoch <code>next_challenge_window_start_epoch</code> Gauge Epoch when next challenge window starts <code>pdp_next_failure</code> Counter Next proving period task failures <code>pdp_prove_failure</code> Counter Proof generation task failures <code>message_send_failure</code> Counter Blockchain message send failures <code>message_estimate_gas_failure</code> Counter Gas estimation failures"},{"location":"concepts/telemetry/#replication-metrics","title":"Replication Metrics","text":"Metric Type Description <code>transfer_duration</code> Histogram Replica transfer operation duration <p>Labels:</p> Label Description <code>source</code> Origin endpoint where data is pulled from <code>sink</code> Destination endpoint where data is written to (this node)"},{"location":"concepts/telemetry/#server-info","title":"Server Info","text":"<p>Build and runtime information:</p> Metric Type Description <code>piri_server_info</code> Info Server metadata <p>Labels:</p> Label Description <code>version</code> Piri software version <code>commit</code> Git commit hash of the build <code>built_by</code> Build system identifier <code>build_date</code> When the binary was compiled <code>start_time_unix</code> Server start time (Unix timestamp) <code>server_type</code> Server mode (<code>full</code> or <code>ucan</code>) <code>did</code> Server's Decentralized Identifier <code>owner_address</code> Ethereum address of node owner <code>public_url</code> Server's publicly accessible URL <code>proof_set</code> PDP proof set ID"},{"location":"concepts/telemetry/#traces","title":"Traces","text":"<p>Distributed tracing provides end-to-end visibility into operations:</p> Span Description <code>blob.accept</code> Blob acceptance operations <code>blob.allocate</code> Blob allocation operations <code>space.content.retrieve</code> Content retrieval operations <code>AddRoots</code> PDP root addition operations <p>Traces use parent-based sampling and integrate with W3C Trace Context propagation.</p>"},{"location":"concepts/telemetry/#integration","title":"Integration","text":""},{"location":"concepts/telemetry/#prometheus","title":"Prometheus","text":"<p>Use an OpenTelemetry Collector with a Prometheus exporter:</p> <pre><code># otel-collector-config.yaml\nreceivers:\n  otlp:\n    protocols:\n      http:\n        endpoint: \"0.0.0.0:4317\"\n\nexporters:\n  prometheus:\n    endpoint: \"0.0.0.0:9090\"\n\nservice:\n  pipelines:\n    metrics:\n      receivers: [otlp]\n      exporters: [prometheus]\n</code></pre> <p>Configure Piri to send metrics to your collector:</p> <pre><code>[[telemetry.metrics]]\nendpoint = \"http://localhost:4317\"\ninsecure = true\npublish_interval = \"30s\"\n</code></pre>"},{"location":"concepts/telemetry/#jaeger","title":"Jaeger","text":"<p>For distributed tracing, configure a Jaeger backend with OTLP support:</p> <pre><code>[[telemetry.traces]]\nendpoint = \"http://jaeger:4317\"\ninsecure = true\n</code></pre>"},{"location":"concepts/telemetry/#grafana","title":"Grafana","text":"<p>Connect your Prometheus datasource and create dashboards using the metrics above. Key metrics to monitor:</p> <ul> <li>System health: <code>system_cpu_utilization</code>, <code>system_memory_used_bytes</code>, <code>piri_datadir_free_bytes</code></li> <li>Job queue health: <code>active_jobs</code>, <code>failed_jobs</code>, <code>job_duration</code></li> <li>API performance: <code>http.server.request.duration</code> (p95, p99)</li> </ul>"},{"location":"concepts/telemetry/#configuration","title":"Configuration","text":"<p>See Configuration &gt; telemetry for collector setup options.</p>"},{"location":"concepts/telemetry/#analytics","title":"Analytics","text":"<p>Piri can optionally send anonymized analytics to Storacha to help improve the software. See Operations &gt; Telemetry for details and opt-out instructions.</p>"},{"location":"configuration/","title":"Configuration","text":"<p>Piri uses a TOML configuration file. The <code>piri init</code> command generates a complete config file for you - this reference helps you understand and tune it.</p>"},{"location":"configuration/#priority","title":"Priority","text":"<p>Configuration is evaluated in this order (highest to lowest priority):</p> <ol> <li>CLI flags</li> <li>Environment variables</li> <li>Config file</li> <li>Network preset defaults</li> <li>Built-in defaults</li> </ol>"},{"location":"configuration/#config-file-locations","title":"Config File Locations","text":"<p>Piri searches for config files in this order:</p> <ol> <li>Path specified via <code>--config</code> flag</li> <li><code>~/.config/piri/config.toml</code></li> <li><code>piri-config.toml</code> in current directory</li> </ol>"},{"location":"configuration/#environment-variables","title":"Environment Variables","text":"<p>Override any config value with <code>PIRI_</code> prefix, replacing dots with underscores:</p> <pre><code>repo.data_dir \u2192 PIRI_REPO_DATA_DIR\n</code></pre>"},{"location":"configuration/#dynamic-configuration","title":"Dynamic Configuration","text":"<p>Most settings require a restart. The following can be changed at runtime via the admin config commands:</p> Key Type Default Description <code>pdp.aggregation.manager.poll_interval</code> duration <code>30s</code> How often the aggregation manager polls for new work <code>pdp.aggregation.manager.batch_size</code> duration <code>10</code> Maximum number of items to process in a single batch"},{"location":"configuration/#minimal-example","title":"Minimal Example","text":"<pre><code>network = \"forge-prod\"\n\n[identity]\nkey_file = \"/path/to/service.pem\"\n\n[repo]\ndata_dir = \"/data/piri\"\ntemp_dir = \"/tmp/piri\"\n\n[server]\nport = 3000\nhost = \"0.0.0.0\"\npublic_url = \"https://piri.example.com\"\n\n[pdp]\nowner_address = \"0x...\"\nlotus_endpoint = \"wss://lotus.example.com/rpc/v1\"\n\n[ucan]\nproof_set = 123\n</code></pre>"},{"location":"configuration/#sections","title":"Sections","text":""},{"location":"configuration/#network","title":"network","text":"<p>Network selection (<code>forge-prod</code>, <code>warm-staging</code>).</p>"},{"location":"configuration/#identity","title":"identity","text":"<p>Node identity configuration.</p>"},{"location":"configuration/#repo","title":"repo","text":"<p>Storage directory configuration.</p>"},{"location":"configuration/#server","title":"server","text":"<p>HTTP server configuration.</p>"},{"location":"configuration/#pdp","title":"pdp","text":"<p>PDP (Provable Data Possession) configuration.</p>"},{"location":"configuration/#ucan","title":"ucan","text":"<p>UCAN service configuration.</p>"},{"location":"configuration/#telemetry","title":"telemetry","text":"<p>Observability configuration.</p>"},{"location":"configuration/identity/","title":"identity","text":"<p>Node identity configuration.</p> Key Default Env Dynamic <code>identity.key_file</code> - <code>PIRI_IDENTITY_KEY_FILE</code> No"},{"location":"configuration/identity/#fields","title":"Fields","text":""},{"location":"configuration/identity/#key_file","title":"<code>key_file</code>","text":"<p>Path to ED25519 PEM private key file. Generate with <code>piri identity generate</code>.</p>"},{"location":"configuration/identity/#toml","title":"TOML","text":"<pre><code>[identity]\nkey_file = \"/etc/piri/service.pem\"\n</code></pre>"},{"location":"configuration/network/","title":"network","text":"<p>Network selection for connecting to Storacha.</p> Key Default Env Dynamic <code>network</code> - <code>PIRI_NETWORK</code> No"},{"location":"configuration/network/#overview","title":"Overview","text":"<p>The <code>network</code> field selects which Storacha network to connect to. This automatically configures service URLs, contract addresses, and chain IDs.</p>"},{"location":"configuration/network/#values","title":"Values","text":"Network Description <code>forge-prod</code> Production network (recommended) <code>warm-staging</code> Staging environment for testing"},{"location":"configuration/network/#toml","title":"TOML","text":"<pre><code>network = \"forge-prod\"\n</code></pre>"},{"location":"configuration/server/","title":"server","text":"<p>HTTP server configuration.</p> Key Default Env Dynamic <code>server.port</code> <code>3000</code> <code>PIRI_SERVER_PORT</code> No <code>server.host</code> <code>0.0.0.0</code> <code>PIRI_SERVER_HOST</code> No <code>server.public_url</code> <code>http://{host}:{port}</code> <code>PIRI_SERVER_PUBLIC_URL</code> No"},{"location":"configuration/server/#fields","title":"Fields","text":""},{"location":"configuration/server/#port","title":"<code>port</code>","text":"<p>HTTP listening port (1-65535).</p>"},{"location":"configuration/server/#host","title":"<code>host</code>","text":"<p>HTTP listening host/interface.</p>"},{"location":"configuration/server/#public_url","title":"<code>public_url</code>","text":"<p>Externally accessible URL. Defaults to <code>http://{host}:{port}</code> if not set.</p>"},{"location":"configuration/server/#toml","title":"TOML","text":"<pre><code>[server]\nport = 3000\nhost = \"0.0.0.0\"\npublic_url = \"https://piri.example.com\"\n</code></pre>"},{"location":"configuration/telemetry/","title":"telemetry","text":"<p>Observability configuration for metrics and distributed tracing.</p> Key Default Env Dynamic <code>telemetry.disable_storacha_analytics</code> <code>false</code> <code>PIRI_TELEMETRY_DISABLE_STORACHA_ANALYTICS</code> No"},{"location":"configuration/telemetry/#fields","title":"Fields","text":""},{"location":"configuration/telemetry/#disable_storacha_analytics","title":"<code>disable_storacha_analytics</code>","text":"<p>Disable sending analytics to Storacha. See Operations &gt; Telemetry for details on what data is collected.</p>"},{"location":"configuration/telemetry/#metrics","title":"<code>metrics</code>","text":"<p>Array of OTLP metrics collector configurations. Each entry supports:</p> Field Required Description <code>endpoint</code> Yes OTLP HTTP endpoint (e.g., <code>https://otel.example.com:4317</code>) <code>insecure</code> No Use HTTP instead of HTTPS (default: <code>false</code>) <code>publish_interval</code> No How often to publish metrics (Go duration, e.g., <code>30s</code>) <code>headers</code> No Custom HTTP headers (e.g., for authentication)"},{"location":"configuration/telemetry/#traces","title":"<code>traces</code>","text":"<p>Array of OTLP trace collector configurations. Each entry supports:</p> Field Required Description <code>endpoint</code> Yes OTLP HTTP endpoint <code>insecure</code> No Use HTTP instead of HTTPS (default: <code>false</code>) <code>headers</code> No Custom HTTP headers <p>See Concepts &gt; Telemetry for details on available metrics and traces.</p>"},{"location":"configuration/telemetry/#toml","title":"TOML","text":"<pre><code>[telemetry]\ndisable_storacha_analytics = false\n\n[[telemetry.metrics]]\nendpoint = \"https://otel.example.com:4317\"\ninsecure = false\npublish_interval = \"30s\"\nheaders = { Authorization = \"Bearer ...\" }\n\n[[telemetry.traces]]\nendpoint = \"https://otel.example.com:4317\"\ninsecure = false\nheaders = { Authorization = \"Bearer ...\" }\n</code></pre>"},{"location":"configuration/ucan/","title":"ucan","text":"<p>UCAN service configuration.</p> Key Default Env Dynamic <code>ucan.proof_set</code> - <code>PIRI_UCAN_PROOF_SET</code> No"},{"location":"configuration/ucan/#fields","title":"Fields","text":""},{"location":"configuration/ucan/#proof_set","title":"<code>proof_set</code>","text":"<p>Proof set ID from initialization.</p>"},{"location":"configuration/ucan/#toml","title":"TOML","text":"<pre><code>[ucan]\nproof_set = 123\n</code></pre> Preset-Managed Fields  These fields are automatically configured by the `network` preset. You typically don't need to set them manually. See [presets](../presets.md) for details.  ## [ucan.services]  External service connections.  ### [ucan.services.indexer]  <pre><code>[ucan.services.indexer]\ndid = \"did:web:indexer.forge.storacha.network\"\nurl = \"https://indexer.forge.storacha.network/claims\"\nproof = \"...\"  # Optional delegation proof\n</code></pre>  ### [ucan.services.upload]  <pre><code>[ucan.services.upload]\ndid = \"did:web:up.forge.storacha.network\"\nurl = \"https://up.forge.storacha.network\"\n</code></pre>  ### [ucan.services.etracker]  Egress tracker for usage reporting.  | Key | Default | Env | Dynamic | |-----|---------|-----|---------| | `ucan.services.etracker.max_batch_size_bytes` | `104857600` | `PIRI_UCAN_SERVICES_ETRACKER_MAX_BATCH_SIZE_BYTES` | No |  Constraints: 10MiB - 1GiB  <pre><code>[ucan.services.etracker]\ndid = \"did:web:etracker.forge.storacha.network\"\nurl = \"https://etracker.forge.storacha.network\"\nreceipts_endpoint = \"https://...\"\nmax_batch_size_bytes = 104857600  # 100 MiB\nproof = \"...\"  # Optional\n</code></pre>  ### [ucan.services.publisher]  IPNI announcement configuration.  <pre><code>[ucan.services.publisher]\nipni_announce_urls = [\n  \"https://cid.contact/announce\",\n  \"https://ipni.forge.storacha.network\"\n]\n</code></pre>  ### [ucan.services.principal_mapping]  Maps service DIDs to principal DIDs.  <pre><code>[ucan.services]\nprincipal_mapping = { \"did:web:up.forge.storacha.network\" = \"did:key:z6Mk...\" }\n</code></pre>"},{"location":"configuration/pdp/","title":"pdp","text":"<p>PDP (Provable Data Possession) service configuration.</p> Key Default Env Dynamic <code>pdp.owner_address</code> - <code>PIRI_PDP_OWNER_ADDRESS</code> No <code>pdp.lotus_endpoint</code> - <code>PIRI_PDP_LOTUS_ENDPOINT</code> No"},{"location":"configuration/pdp/#fields","title":"Fields","text":""},{"location":"configuration/pdp/#owner_address","title":"<code>owner_address</code>","text":"<p>Ethereum address that owns the proof set.</p>"},{"location":"configuration/pdp/#lotus_endpoint","title":"<code>lotus_endpoint</code>","text":"<p>Filecoin Lotus node WebSocket endpoint.</p>"},{"location":"configuration/pdp/#toml","title":"TOML","text":"<pre><code>[pdp]\nowner_address = \"0x1234...\"\nlotus_endpoint = \"wss://lotus.example.com/rpc/v1\"\n</code></pre>"},{"location":"configuration/pdp/#aggregation","title":"aggregation","text":"<p>Aggregation system configuration.</p> Preset-Managed Fields <p>These fields are automatically configured by the <code>network</code> preset. You almost never should set them manually. See Networks for details.</p> Key Default Env Dynamic <code>pdp.chain_id</code> - <code>PIRI_PDP_CHAIN_ID</code> No <code>pdp.payer_address</code> - <code>PIRI_PDP_PAYER_ADDRESS</code> No"},{"location":"configuration/pdp/#chain_id","title":"<code>chain_id</code>","text":"<p>Filecoin chain ID. <code>314</code> for mainnet, <code>314159</code> for calibration.</p>"},{"location":"configuration/pdp/#payer_address","title":"<code>payer_address</code>","text":"<p>Ethereum address that pays storage providers.</p>"},{"location":"configuration/pdp/#pdpsigning_service","title":"pdp.signing_service","text":"<p>Configure transaction signing. Use either remote signing service OR local private key (not both).</p> <p>Remote signing (recommended for production):</p> <pre><code>[pdp.signing_service]\ndid = \"did:web:signer.forge.storacha.network\"\nurl = \"https://signer.forge.storacha.network\"\n</code></pre> <p>Local signing (development only):</p> <pre><code>[pdp.signing_service]\nprivate_key = \"0x...\"  # Hex-encoded ECDSA private key\n</code></pre>"},{"location":"configuration/pdp/#pdpcontracts","title":"pdp.contracts","text":"<p>Smart contract addresses.</p> <pre><code>[pdp.contracts]\nverifier = \"0x...\"\nprovider_registry = \"0x...\"\nservice = \"0x...\"\nservice_view = \"0x...\"\n</code></pre>"},{"location":"configuration/pdp/aggregation/","title":"Aggregation","text":"<p>The aggregation pipeline processes accepted blobs through four stages before submitting proofs to the blockchain:</p> <ol> <li>CommP Calculation - Computes the Piece Commitment/PieceCID.</li> <li>Aggregation - Groups pieces into 128-256MB Aggregates.</li> <li>Batch Management - Batches aggregates for efficient chain submission.</li> <li>Chain Submission - Submits roots to the PDP smart contract(s).</li> </ol>"},{"location":"configuration/pdp/aggregation/#subsections","title":"Subsections","text":""},{"location":"configuration/pdp/aggregation/#commp","title":"commp","text":"<p>CommP calculation job queue configuration.</p>"},{"location":"configuration/pdp/aggregation/#aggregator","title":"aggregator","text":"<p>Piece aggregation job queue configuration.</p>"},{"location":"configuration/pdp/aggregation/#manager","title":"manager","text":"<p>Batch management and chain submission configuration.</p>"},{"location":"configuration/pdp/aggregation/aggregator/","title":"Aggregator","text":"<p>Piece aggregation configuration.</p> Key Default Env Dynamic <code>pdp.aggregation.aggregator.job_queue.workers</code> <code>runtime.NumCPU()</code> <code>PIRI_PDP_AGGREGATION_AGGREGATOR_JOB_QUEUE_WORKERS</code> No <code>pdp.aggregation.aggregator.job_queue.retries</code> <code>50</code> <code>PIRI_PDP_AGGREGATION_AGGREGATOR_JOB_QUEUE_RETRIES</code> No <code>pdp.aggregation.aggregator.job_queue.retry_delay</code> <code>10s</code> <code>PIRI_PDP_AGGREGATION_AGGREGATOR_JOB_QUEUE_RETRY_DELAY</code> No"},{"location":"configuration/pdp/aggregation/aggregator/#overview","title":"Overview","text":"<p>The aggregator groups pieces into aggregates between 128MB and 256MB.  When a piece's CommP hash is calculated, it enters this queue to be combined with other pieces into an aggregate.</p> <p>How aggregation works:</p> <ul> <li>Pieces are buffered until total size reaches 128MB minimum</li> <li>Pieces larger than 128MB are submitted immediately as single-piece aggregates</li> <li>The maximum aggregate size is 256MB</li> </ul> <p>Performance Note: Aggregate creation involves building merkle trees from piece commitments (32-byte hashes).  Memory usage is minimal since only the CommP hashes are held in memory, not the actual blob data.</p>"},{"location":"configuration/pdp/aggregation/aggregator/#fields","title":"Fields","text":""},{"location":"configuration/pdp/aggregation/aggregator/#job_queueworkers","title":"<code>job_queue.workers</code>","text":"<p>Number of concurrent aggregation operations. Defaults to the number of CPU cores.</p> <ul> <li>Higher values: Faster aggregate creation when many pieces complete CommP calculation simultaneously</li> <li>Lower values: Reduced concurrency, but memory impact is minimal since only piece hashes are processed</li> </ul>"},{"location":"configuration/pdp/aggregation/aggregator/#job_queueretries","title":"<code>job_queue.retries</code>","text":"<p>Maximum retry attempts before a piece is moved to the dead-letter queue.</p>"},{"location":"configuration/pdp/aggregation/aggregator/#job_queueretry_delay","title":"<code>job_queue.retry_delay</code>","text":"<p>Wait time between retry attempts after a failure.</p>"},{"location":"configuration/pdp/aggregation/aggregator/#toml","title":"TOML","text":"<pre><code>[pdp.aggregation.aggregator.job_queue]\nworkers = 2\nretries = 50\nretry_delay = \"10s\"\n</code></pre>"},{"location":"configuration/pdp/aggregation/commp/","title":"CommP","text":"<p>CommP (Piece Commitment) configuration.</p> Key Default Env Dynamic <code>pdp.aggregation.commp.job_queue.workers</code> <code>runtime.NumCPU()</code> <code>PIRI_PDP_AGGREGATION_COMMP_JOB_QUEUE_WORKERS</code> No <code>pdp.aggregation.commp.job_queue.retries</code> <code>50</code> <code>PIRI_PDP_AGGREGATION_COMMP_JOB_QUEUE_RETRIES</code> No <code>pdp.aggregation.commp.job_queue.retry_delay</code> <code>10s</code> <code>PIRI_PDP_AGGREGATION_COMMP_JOB_QUEUE_RETRY_DELAY</code> No"},{"location":"configuration/pdp/aggregation/commp/#overview","title":"Overview","text":"<p>CommP calculation is the first stage of the aggregation pipeline. When a blob is uploaded, it enters this queue to have  its Piece Commitment hash calculated. This hash is required for creating aggregates that can be submitted to the  blockchain.</p> <p>Performance Note: CommP calculation is CPU-intensive. Each worker consumes significant CPU resources while processing a blob.</p>"},{"location":"configuration/pdp/aggregation/commp/#fields","title":"Fields","text":""},{"location":"configuration/pdp/aggregation/commp/#job_queueworkers","title":"<code>job_queue.workers</code>","text":"<p>Number of concurrent CommP calculations. Defaults to the number of CPU cores.</p> <ul> <li>Higher values: Faster throughput when many blobs arrive simultaneously, but higher CPU usage</li> <li>Lower values: Reduced CPU load, but blobs queue longer during high ingest periods</li> </ul>"},{"location":"configuration/pdp/aggregation/commp/#job_queueretries","title":"<code>job_queue.retries</code>","text":"<p>Maximum retry attempts before a blob is moved to the dead-letter queue.</p>"},{"location":"configuration/pdp/aggregation/commp/#job_queueretry_delay","title":"<code>job_queue.retry_delay</code>","text":"<p>Wait time between retry attempts after a failure.</p>"},{"location":"configuration/pdp/aggregation/commp/#toml","title":"TOML","text":"<pre><code>[pdp.aggregation.commp.job_queue]\nworkers = 4        # Limit to 4 cores for shared environments\nretries = 50\nretry_delay = \"10s\"\n</code></pre>"},{"location":"configuration/pdp/aggregation/manager/","title":"Manager","text":"<p>Aggregation manager configuration.</p> Key Default Env Dynamic <code>pdp.aggregation.manager.poll_interval</code> <code>30s</code> <code>PIRI_PDP_AGGREGATION_MANAGER_POLL_INTERVAL</code> Yes <code>pdp.aggregation.manager.batch_size</code> <code>10</code> <code>PIRI_PDP_AGGREGATION_MANAGER_BATCH_SIZE</code> Yes <code>pdp.aggregation.manager.job_queue.workers</code> <code>runtime.NumCPU()</code> <code>PIRI_PDP_AGGREGATION_MANAGER_JOB_QUEUE_WORKERS</code> No <code>pdp.aggregation.manager.job_queue.retries</code> <code>50</code> <code>PIRI_PDP_AGGREGATION_MANAGER_JOB_QUEUE_RETRIES</code> No <code>pdp.aggregation.manager.job_queue.retry_delay</code> <code>10s</code> <code>PIRI_PDP_AGGREGATION_MANAGER_JOB_QUEUE_RETRY_DELAY</code> No"},{"location":"configuration/pdp/aggregation/manager/#overview","title":"Overview","text":"<p>The manager is the final stage of the aggregation pipeline before chain submission.  It buffers completed aggregates and submits them to the blockchain in batches.</p> <p>How it works:</p> <ul> <li>Aggregates are buffered as they complete</li> <li>When <code>poll_interval</code> elapses OR <code>batch_size</code> is reached, the buffer is submitted</li> <li>Submissions are enqueued to a job queue for reliable delivery</li> </ul> <p>Dynamic Configuration: Both <code>poll_interval</code> and <code>batch_size</code> can be changed at runtime using the admin API.  Changes take effect immediately.</p>"},{"location":"configuration/pdp/aggregation/manager/#fields","title":"Fields","text":""},{"location":"configuration/pdp/aggregation/manager/#poll_interval","title":"<code>poll_interval</code>","text":"<p>The frequency in which the aggregation manager submits roots to the chain.</p>"},{"location":"configuration/pdp/aggregation/manager/#batch_size","title":"<code>batch_size</code>","text":"<p>The maximum number of roots to submit in a single message.</p>"},{"location":"configuration/pdp/aggregation/manager/#job_queueworkers","title":"<code>job_queue.workers</code>","text":"<p>The number of workers spawned by the manager controlling the number of roots that may be submitted in parallel.</p>"},{"location":"configuration/pdp/aggregation/manager/#job_queueretries","title":"<code>job_queue.retries</code>","text":"<p>The number of times to retry submitting a root before the operation is considered failed.</p>"},{"location":"configuration/pdp/aggregation/manager/#job_queueretry_delay","title":"<code>job_queue.retry_delay</code>","text":"<p>The duration to wait between successive failures.</p>"},{"location":"configuration/pdp/aggregation/manager/#gas-usage","title":"Gas Usage","text":"<p>The manager configuration directly affects gas costs for chain submission.</p>"},{"location":"configuration/pdp/aggregation/manager/#how-batching-reduces-gas","title":"How batching reduces gas","text":"<p>Each blockchain transaction has:</p> <ul> <li>Fixed costs: Transaction overhead, signature verification</li> <li>Variable costs: Per-root data storage</li> </ul> <p>By batching multiple roots into a single transaction, you amortize fixed costs across more roots.</p>"},{"location":"configuration/pdp/aggregation/manager/#configuration-trade-offs","title":"Configuration trade-offs","text":"Setting Effect Gas Impact Higher <code>batch_size</code> More roots per transaction Lower gas per root Lower <code>batch_size</code> Fewer roots per transaction Higher gas per root Higher <code>poll_interval</code> More time to fill batches Better batching, lower gas Lower <code>poll_interval</code> Less time to fill batches Faster finality, potentially higher gas"},{"location":"configuration/pdp/aggregation/manager/#recommendations","title":"Recommendations","text":"<p>High-volume nodes (many blobs/hour):</p> <ul> <li>Use default or higher <code>batch_size</code> (10+)</li> <li>Use moderate <code>poll_interval</code> (30s-60s)</li> <li>Batches will naturally fill, optimizing gas</li> </ul> <p>Low-volume nodes (few blobs/hour):</p> <ul> <li>Consider higher <code>poll_interval</code> (60s-300s) to allow batches to fill</li> <li>Or accept higher per-root gas cost for faster finality</li> </ul> <p>Cost-sensitive deployments:</p> <ul> <li>Maximize <code>batch_size</code> and <code>poll_interval</code></li> <li>Trade finality speed for gas efficiency</li> </ul>"},{"location":"configuration/pdp/aggregation/manager/#toml","title":"TOML","text":"<pre><code>[pdp.aggregation.manager]\npoll_interval = \"30s\"\nbatch_size = 10\n\n[pdp.aggregation.manager.job_queue]\nworkers = 3\nretries = 50\nretry_delay = \"1m\"\n</code></pre>"},{"location":"configuration/repo/","title":"repo","text":"<p>Storage directory configuration.</p> Key Default Env Dynamic <code>repo.data_dir</code> <code>$HOME/.storacha/</code> <code>PIRI_REPO_DATA_DIR</code> No <code>repo.temp_dir</code> - <code>PIRI_REPO_TEMP_DIR</code> No"},{"location":"configuration/repo/#fields","title":"Fields","text":""},{"location":"configuration/repo/#data_dir","title":"<code>data_dir</code>","text":"<p>Directory for persistent data (databases, blobs, claims).</p>"},{"location":"configuration/repo/#temp_dir","title":"<code>temp_dir</code>","text":"<p>Directory for temporary files during processing.</p>"},{"location":"configuration/repo/#toml","title":"TOML","text":"<pre><code>[repo]\ndata_dir = \"/data/piri\"\ntemp_dir = \"/tmp/piri\"\n</code></pre>"},{"location":"configuration/repo/database/","title":"database","text":"<p>Database backend configuration.</p> Key Default Env Dynamic <code>repo.database.type</code> <code>sqlite</code> <code>PIRI_REPO_DATABASE_TYPE</code> No <code>repo.database.postgres.url</code> - <code>PIRI_REPO_DATABASE_POSTGRES_URL</code> No <code>repo.database.postgres.max_open_conns</code> <code>5</code> <code>PIRI_REPO_DATABASE_POSTGRES_MAX_OPEN_CONNS</code> No <code>repo.database.postgres.max_idle_conns</code> <code>5</code> <code>PIRI_REPO_DATABASE_POSTGRES_MAX_IDLE_CONNS</code> No <code>repo.database.postgres.conn_max_lifetime</code> <code>30m</code> <code>PIRI_REPO_DATABASE_POSTGRES_CONN_MAX_LIFETIME</code> No"},{"location":"configuration/repo/database/#fields","title":"Fields","text":""},{"location":"configuration/repo/database/#type","title":"<code>type</code>","text":"<p>Database backend: <code>sqlite</code> (default) or <code>postgres</code>.</p> <p>Important: Database type cannot be changed after initial setup. Data is not migrated between backends. See Database Concepts for details.</p>"},{"location":"configuration/repo/database/#postgresurl","title":"<code>postgres.url</code>","text":"<p>PostgreSQL connection string. Required when <code>type</code> is <code>postgres</code>.</p> <p>Format: <code>postgres://user:password@host:port/dbname?sslmode=disable</code></p>"},{"location":"configuration/repo/database/#postgresmax_open_conns","title":"<code>postgres.max_open_conns</code>","text":"<p>Maximum number of open connections to the database.</p>"},{"location":"configuration/repo/database/#postgresmax_idle_conns","title":"<code>postgres.max_idle_conns</code>","text":"<p>Maximum number of idle connections in the pool.</p>"},{"location":"configuration/repo/database/#postgresconn_max_lifetime","title":"<code>postgres.conn_max_lifetime</code>","text":"<p>Maximum lifetime for a connection. Accepts Go duration strings (e.g., <code>30m</code>, <code>1h</code>).</p>"},{"location":"configuration/repo/database/#toml","title":"TOML","text":"<p>SQLite (default - no configuration needed):</p> <pre><code>[repo]\ndata_dir = \"/data/piri\"\n</code></pre> <p>PostgreSQL:</p> <pre><code>[repo.database]\ntype = \"postgres\"\n\n[repo.database.postgres]\nurl = \"postgres://piri:secret@localhost:5432/piri?sslmode=disable\"\nmax_open_conns = 10\nmax_idle_conns = 5\nconn_max_lifetime = \"30m\"\n</code></pre>"},{"location":"operations/best-practices/","title":"Best Practices for running a Piri node","text":""},{"location":"operations/best-practices/#keep-your-lotus-node-up-to-date","title":"Keep your Lotus node up to date","text":"<p>Your Piri node depends on a Lotus node that is fully synced and on the current release. If Lotus falls behind, Piri cannot submit proofs on time and you risk missing proving windows.  Always update Lotus to the latest release as soon as it is published, and monitor the Filecoin Slack <code>#fil-lotus-announcements</code> channel for release notices and upgrade guidance.</p>"},{"location":"operations/best-practices/#keep-your-piri-node-up-to-date","title":"Keep your Piri node up to date","text":"<p>Running the latest Piri release keeps you protocol-compatible with the Storacha network, pulls in bug fixes and security patches, and ensures your node understands the current proof and API expectations.  Watch the latest releases and upgrade promptly when a new version is published; release notes will call out any operator actions or migrations needed.</p> <p>Join the Storacha Discord for announcements and operator guidance: invite.</p> <p>Announcements related to Piri and the Forge network are made in:</p> <ul> <li><code>#piri-announcements</code></li> <li><code>#storacha-forge-production-network</code>.</li> </ul>"},{"location":"operations/best-practices/#do-not-use-the-same-filecoin-wallet-on-staging-and-production","title":"Do not use the same Filecoin wallet on staging and production","text":"<p>Use separate wallets for staging/test networks and production. Sharing the same key leaks metadata across chains, risks accidentally spending production funds during testing, and complicates audits of reward flows. Keep production keys in your normal secure key management flow, and configure Piri with the appropriate <code>wallet.hex</code> for each environment. If you rotate keys, update both the file and any systemd unit or environment configuration to point at the new wallet.</p>"},{"location":"operations/best-practices/#install-piri-as-a-systemd-service","title":"Install Piri as a systemd service","text":"<p>The following unit file is an example only. Replace the placeholder values (network, endpoints, paths, email, public URL, etc.) with the settings that match your host layout and preferences. Typical workflow:</p> <ul> <li>Save the adapted unit as <code>/etc/systemd/system/piri.service</code>.</li> <li>Create the <code>piri</code> user and group (or use an existing service account), and ensure <code>/etc/piri</code>, <code>/data/piri</code>, and <code>/tmp/piri</code> exist with correct ownership.</li> <li>Reload units after edits with <code>sudo systemctl daemon-reload</code>.</li> <li>Enable at boot with <code>sudo systemctl enable piri</code>, start with <code>sudo systemctl start piri</code>, stop with <code>sudo systemctl stop piri</code>, restart with <code>sudo systemctl restart piri</code>, and check status with <code>sudo systemctl status piri</code>.</li> <li>View logs with <code>sudo journalctl -u piri -f</code> (live) or add <code>--since</code>/<code>--until</code> for time windows.</li> </ul> <p>Use the template below as a starting point (replace the sample values with your own):</p> <pre><code>[Unit]\n# Human-readable description of the service, shown in tools like `systemctl status`.\nDescription=Piri Server \n\n# Tells systemd to only start this unit after the network stack is fully up.\nAfter=network-online.target\n\n# Declares a soft dependency on the network being online (systemd will try to bring it up).\nWants=network-online.target\n\n[Service]\n# `simple` means the process started by ExecStart is the main service process\n# and systemd considers it started as soon as it\u2019s spawned.\nType=simple\n\n# Unix user account that the service runs under (change to whatever you use).\nUser=piri\n\n# Primary group for the service process (usually matches the user).\nGroup=piri\n\n# Working directory for the service process; relative paths are resolved from here.\nWorkingDirectory=/etc/piri\n\n# Maximum time in seconds systemd waits for all ExecStartPre + ExecStart to complete startup\n# before marking the service as failed. 900 = 5 min\nTimeoutStartSec=900\n\n# Automatically restart the service when it exits with a non-zero status.\nRestart=on-failure\n\n# How long systemd waits before attempting a restart after a failure.\nRestartSec=10\n\n# Pre-start command: (re)generate piri config before launching the server.\n# All values shown below are examples, populate the values based on your setup.\nExecStartPre=/usr/local/bin/piri init \\\n  --network=[forge-prod|warm-staging] \\\n  --data-dir=/data/piri \\\n  --temp-dir=/tmp/piri \\\n  --key-file=/etc/piri/service.pem \\\n  --wallet-file=/etc/piri/wallet.hex \\\n  --lotus-endpoint=\"https://lotus.example.com/rpc/v1\" \\\n  --operator-email=\"operator@example.com\" \\\n  --public-url=\"https://piri.example.com\" \\\n  &gt; /etc/piri/config.toml\n\n# Main process to run for this service: starts the piri server using the generated config.\nExecStart=/usr/local/bin/piri serve --config=/etc/piri/config.toml\n\n[Install]\n# Targets this service should be pulled into when enabled. `multi-user.target`\n# is the standard \u201cnormal system\u201d runlevel on most distros, so this makes the\n# service start automatically at boot in multi-user mode.\nWantedBy=multi-user.target\n</code></pre>"},{"location":"operations/best-practices/#tune-your-kernel","title":"Tune your Kernel","text":"<p>Many kernel defaults are not suited for running a performant Piri node. Below is a set of recommendations for tuning your node for optimal performance when operating on the Storacha network.</p> <pre><code># Piri Storage Node - Network Tuning\n# Apply with: sysctl -p /etc/sysctl.d/99-piri.conf\n# Takes effect on NEW connections only.\n\n# TCP buffer sizes (64MB max, 1MB default)\n# Required for high throughput at high latency (1Gbps at 200ms RTT needs ~25MB)\nnet.core.rmem_max = 67108864\nnet.core.wmem_max = 67108864\nnet.ipv4.tcp_rmem = 4096 1048576 67108864\nnet.ipv4.tcp_wmem = 4096 1048576 67108864\n\n# BBR congestion control - handles lossy long-haul links much better than CUBIC\nnet.ipv4.tcp_congestion_control = bbr\n\n# Don't reset to slow-start after idle (kills throughput on bursty workloads)\nnet.ipv4.tcp_slow_start_after_idle = 0\n\n# Connection handling\nnet.core.somaxconn = 65535\nnet.core.netdev_max_backlog = 65535\nnet.ipv4.tcp_max_orphans = 65535\n\n# Window scaling (usually default, but verify)\nnet.ipv4.tcp_window_scaling = 1\n</code></pre>"},{"location":"operations/inspect-proof-set/","title":"Inspect Your Proof Set","text":"<p>After successfully testing your Piri setup, you can inspect your proof sets to monitor storage operations.</p>"},{"location":"operations/inspect-proof-set/#pdp-proof-set-inspector","title":"PDP Proof Set Inspector","text":"<p>Use the explorer for your network to view and inspect proof sets.</p> Prod Visit the PDP Explorer <ul> <li>Visit https://pdp.vxb.ai/mainnet</li> <li>Find your proof set by ID and review status/verification history.</li> </ul> Staging Visit the PDP Explorer <ul> <li>Visit https://pdp.vxb.ai/calibration</li> <li>Find your proof set by ID and review status/verification history.</li> </ul> <p>Your proof set ID can be found in your piri configuration file</p>"},{"location":"operations/telemetry/","title":"Telemetry and Analytics","text":"<p>Piri collects telemetry data to help developers understand how the software is being used and improve the experience of running Piri nodes.  This includes some pseudonymous identifiers (DIDs and Ethereum addresses) that are part of your node's public identity on the network.  Telemetry can be disabled at any time.</p>"},{"location":"operations/telemetry/#why-we-collect-telemetry","title":"Why We Collect Telemetry","text":"<p>Telemetry helps the Piri development team to:</p> <ul> <li>Understand which versions of Piri are actively being used in the network</li> <li>Monitor the health and reliability of the network</li> <li>Identify common deployment patterns and configurations</li> <li>Prioritize development efforts based on actual usage</li> <li>Debug issues more effectively by understanding the runtime environment</li> </ul>"},{"location":"operations/telemetry/#what-data-is-collected","title":"What Data Is Collected","text":"<p>Piri collects information about your node, including pseudonymous identifiers that are part of your node's public network identity:</p>"},{"location":"operations/telemetry/#base-server-information-all-node-types","title":"Base Server Information (All Node Types)","text":"<ul> <li>Version: The Piri software version you're running</li> <li>Commit: The git commit hash of your build</li> <li>Built By: The builder information (typically automated build system)</li> <li>Build Date: When your version was compiled</li> <li>Start Time: Unix timestamp of when the server started</li> <li>Server Type: The type of server (e.g., \"pdp\" or \"ucan\")</li> </ul>"},{"location":"operations/telemetry/#pdp-server-specific-data","title":"PDP Server Specific Data","text":"<ul> <li>Ethereum Address: Your node's Ethereum address for PDP operations</li> </ul>"},{"location":"operations/telemetry/#ucan-server-specific-data","title":"UCAN Server Specific Data","text":"<ul> <li>DID: Your server's Decentralized Identifier</li> <li>Indexing Service DID: The DID of the indexing service you're connected to</li> <li>Indexing Service URL: The URL of the indexing service (public endpoint)</li> <li>Upload Service DID: The DID of the upload service you're connected to</li> <li>Upload Service URL: The URL of the upload service (public endpoint)</li> </ul>"},{"location":"operations/telemetry/#tracing-data","title":"Tracing data","text":"<p>Tracing data is a specialized form of telemetry that provides an end-to-end view of a request's journey as it flows through the various components of a complex, distributed system, such as a microservices architecture.</p>"},{"location":"operations/telemetry/#what-data-is-not-collected","title":"What Data Is NOT Collected","text":"<p>We do NOT collect:</p> <ul> <li>Private keys or any sensitive cryptographic material</li> <li>Personal information beyond what's listed above</li> <li>IP addresses or location data</li> </ul>"},{"location":"operations/telemetry/#how-to-opt-out","title":"How to Opt Out","text":"<p>If you prefer not to share telemetry data, you can disable it by setting the <code>PIRI_DISABLE_ANALYTICS</code> environment variable:</p> <pre><code>export PIRI_DISABLE_ANALYTICS=1\n</code></pre> <p>To make this permanent, add the export to your shell configuration file (e.g., <code>.bashrc</code>, <code>.zshrc</code>).</p> <p>Note: you can opt-out of tracing only by setting the <code>PIRI_TRACING_ENABLED</code> environment variable:</p> <pre><code>export PIRI_TRACING_ENABLED=0\n</code></pre>"},{"location":"operations/telemetry/#data-retention-and-usage","title":"Data Retention and Usage","text":"<ul> <li>Telemetry data is used solely for improving Piri</li> <li>Data is retained for a reasonable period to analyze trends</li> <li>We do not sell or share this data with third parties</li> <li>All data handling follows industry best practices for privacy and security</li> </ul>"},{"location":"operations/telemetry/#technical-implementation","title":"Technical Implementation","text":"<p>Telemetry is implemented using OpenTelemetry, an industry-standard observability framework. The telemetry system:</p> <ul> <li>Initializes during startup unless <code>PIRI_DISABLE_ANALYTICS</code> is set</li> <li>Records server information once at startup</li> <li>Has a 10-second timeout for initialization to prevent blocking</li> <li>Logs warnings if telemetry fails but continues normal operation</li> </ul>"},{"location":"operations/telemetry/#questions-or-concerns","title":"Questions or Concerns","text":"<p>If you have questions about telemetry or privacy, please:</p> <ul> <li>Open an issue on our GitHub repository</li> <li>Contact the development team through official channels</li> </ul> <p>We're committed to transparency and will continue to document any changes to telemetry collection.</p>"},{"location":"operations/upgrading/","title":"Upgrading Piri","text":"<p>This guide covers how to upgrade an existing Piri installation to a newer version.</p>"},{"location":"operations/upgrading/#prerequisites","title":"Prerequisites","text":"<p>Before upgrading, ensure you have:</p> <ul> <li>\u2705 A running Piri installation</li> <li>\u2705 Your configuration file (config.toml)</li> <li>\u2705 Access to the Piri server process</li> </ul>"},{"location":"operations/upgrading/#upgrade-process","title":"Upgrade Process","text":""},{"location":"operations/upgrading/#step-1-stop-running-server","title":"Step 1: Stop Running Server","text":"<p>First, gracefully stop the Piri server:</p> <pre><code># Stop the Piri full server (use Ctrl+C or your process manager)\n</code></pre>"},{"location":"operations/upgrading/#step-2-install-new-version","title":"Step 2: Install New Version","text":"<p>Follow the installation instructions to download and install the latest version of Piri.</p>"},{"location":"operations/upgrading/#step-3-verify-installation","title":"Step 3: Verify Installation","text":"<p>Confirm the new version is installed:</p> <pre><code>piri version\n</code></pre>"},{"location":"operations/upgrading/#step-4-restart-server","title":"Step 4: Restart Server","text":"<p>Restart your Piri server using your existing configuration file:</p> <pre><code>piri serve --config=config.toml\n</code></pre> <p>Note: Do not run <code>piri init</code> when upgrading - your existing configuration and proof set should be preserved.</p>"},{"location":"operations/upgrading/#important-notes","title":"Important Notes","text":"<ul> <li>Always stop the server before upgrading to prevent data corruption</li> <li>Check the release notes for any breaking changes</li> </ul>"},{"location":"operations/upgrading/#troubleshooting","title":"Troubleshooting","text":"<p>If you encounter issues after upgrading:</p> <ol> <li>Check server logs for error messages</li> <li>Verify your configuration file is intact</li> <li>Ensure your Lotus node is still synced and accessible</li> <li>Contact the Storacha team in the Storacha Discord server if problems persist</li> </ol>"},{"location":"setup/installation/","title":"Installing Piri","text":"<p>This section covers the installation of the Piri binary.</p>"},{"location":"setup/installation/#prerequisites","title":"Prerequisites","text":"<p>Before installing, ensure you have:</p> <ul> <li>\u2705 Completed system prerequisites</li> </ul>"},{"location":"setup/installation/#download-pre-compiled-binary","title":"Download Pre-compiled Binary","text":"<p>Download the latest release from v0.2.2:</p>"},{"location":"setup/installation/#for-linux-amd64","title":"For Linux AMD64","text":"<pre><code>wget https://github.com/storacha/piri/releases/download/v0.2.2/piri_0.2.2_linux_amd64.tar.gz\ntar -xzf piri_0.2.2_linux_amd64.tar.gz\nsudo mv piri /usr/local/bin/piri\n</code></pre>"},{"location":"setup/installation/#for-linux-arm64","title":"For Linux ARM64","text":"<pre><code>wget https://github.com/storacha/piri/releases/download/v0.2.2/piri_0.2.2_linux_arm64.tar.gz\ntar -xzf piri_0.2.2_linux_arm64.tar.gz\nsudo mv piri /usr/local/bin/piri\n</code></pre>"},{"location":"setup/installation/#verify-installation","title":"Verify Installation","text":"<pre><code># The output version should match the version installed via the above command\npiri version\n</code></pre>"},{"location":"setup/installation/#next-steps","title":"Next Steps","text":"<p>After installing Piri:</p> <ul> <li>Generate Cryptographic Keys</li> <li>Configure TLS Termination</li> </ul>"},{"location":"setup/key-generation/","title":"Generating and Managing DIDs &amp; Cryptographic Keys","text":"<p>The <code>service.pem</code> file contains your storage provider's cryptographic identity, which corresponds to its DID. This single file is shared by all Piri services you operate to maintain a consistent identity.</p>"},{"location":"setup/key-generation/#prerequisites","title":"Prerequisites","text":"<p>Before generating keys, ensure you have:</p> <ul> <li>\u2705 Installed Piri</li> </ul>"},{"location":"setup/key-generation/#key-requirements","title":"Key Requirements","text":"<p>Piri requires an Ed25519 private key. Ed25519 is a modern elliptic curve signature scheme.</p>"},{"location":"setup/key-generation/#generating-a-pem-file-did","title":"Generating a PEM File &amp; DID","text":"<p>Step 1: Generate a new Ed25519 key</p> <pre><code>piri identity generate &gt; service.pem\n</code></pre> <p>Step 2: Verify and derive your DID</p> <pre><code>piri identity parse service.pem\n</code></pre> <p>Example output: <code>did:key:z6MkhaXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</code></p>"},{"location":"setup/key-generation/#security-considerations","title":"Security Considerations","text":"<ul> <li>Protect this file: It contains your private key</li> <li>Set appropriate file permissions: <code>chmod 600 service.pem</code></li> <li>Backup securely: Loss of this file means loss of your provider identity</li> </ul>"},{"location":"setup/key-generation/#preparing-your-wallet-file","title":"Preparing Your Wallet File","text":"<p>Export your Filecoin wallet address to a hex file:</p> <pre><code># Export wallet from Lotus to hex format\nlotus wallet export YOUR_DELEGATED_ADDRESS &gt; wallet.hex\n</code></pre> <p>This wallet file will be used during the initialization process to import your wallet into Piri.</p>"},{"location":"setup/key-generation/#next-steps","title":"Next Steps","text":"<p>After generating your keys:</p> <ul> <li>Configure TLS Termination</li> </ul>"},{"location":"setup/piri-server/","title":"Setup Piri Node","text":"<p>This guide covers both Forge Production and Forge Staging. The steps are almost identical; only the Lotus network and <code>--network</code> flag differ. Use the Environment dropdown in the header to toggle the values shown.</p>"},{"location":"setup/piri-server/#prerequisites","title":"Prerequisites","text":"<p>Before you start, make sure you have:</p> <ol> <li>\u2705 Set up your system</li> <li>\u2705 Set up and synced a Lotus Node</li> <li>\u2705 Set up TLS (secure connections)</li> <li>\u2705 Installed Piri</li> <li>\u2705 Created your key pair</li> <li>\u2705 Created a wallet with funds</li> </ol>"},{"location":"setup/piri-server/#initialize-your-piri-node","title":"Initialize Your Piri Node","text":"<p>The <code>piri init</code> command does all the setup needed to join the Storacha network:</p> <ul> <li>Imports your wallet</li> <li>Creates a proof set (if you don't have one)</li> <li>Signs you up with the Storacha network</li> <li>Creates a configuration file</li> </ul>"},{"location":"setup/piri-server/#run-initialization","title":"Run Initialization","text":"<p>Run the <code>piri init</code> command with all needed settings. The configuration file goes to stdout and progress messages go to stderr, so you can save the output to a file. The command below switches based on the environment selection:</p> Prod Use this command <pre><code>piri init \\\n  --network=forge-prod \\\n  --data-dir=/path/to/data \\\n  --temp-dir=/path/to/temp \\\n  --key-file=/path/to/service.pem \\\n  --wallet-file=/path/to/wallet.hex \\\n  --lotus-endpoint=wss://YOUR_LOTUS_ENDPOINT/rpc/v1 \\\n  --operator-email=your-email@example.com \\\n  --public-url=https://piri.example.com &gt; config.toml\n</code></pre> Staging Use this command <pre><code>piri init \\\n  --network=warm-staging \\\n  --data-dir=/path/to/data \\\n  --temp-dir=/path/to/temp \\\n  --key-file=/path/to/service.pem \\\n  --wallet-file=/path/to/wallet.hex \\\n  --lotus-endpoint=wss://YOUR_LOTUS_ENDPOINT/rpc/v1 \\\n  --operator-email=your-email@example.com \\\n  --public-url=https://piri.example.com &gt; config.toml\n</code></pre> <p>Note: if you move the config file to your user config directory (e.g. <code>~/.config/piri/config.toml</code> on Linux) then Piri will automatically load it on start.</p> <p>Settings:</p> <ul> <li><code>--network</code>: The network to join</li> <li><code>--data-dir</code>: Folder for permanent Piri data</li> <li><code>--temp-dir</code>: Folder for temporary data</li> <li><code>--key-file</code>: Path to your identity PEM file</li> <li><code>--wallet-file</code>: Path to your wallet hex file</li> <li><code>--lotus-endpoint</code>: WebSocket address of your Lotus node</li> <li><code>--operator-email</code>: Your email so the Storacha team can contact you</li> <li><code>--public-url</code>: The public HTTPS address for your Piri node (use the domain from the TLS setup, like <code>https://piri.example.com</code>)</li> </ul> <p>Expected Output:</p> <p>\ud83d\udca1Note: Step 3 <code>Setting up proof set</code> can take up to 5 minutes to complete.</p> <pre><code>\ud83d\ude80 Initializing your Piri node on the Storacha Network...\n\n[1/5] Validating configuration...\n\u2705 Configuration validated\n\n[2/5] Creating Piri node...\n\u2705 Node created with DID: did:key:z6MkhaXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX\n\n[3/5] Setting up proof set...\n\ud83d\udcdd Creating new proof set...\n\u23f3 Waiting for proof set creation to be confirmed on-chain...\n   Transaction status: pending\n   Transaction status: confirmed\n\u2705 Proof set created with ID: 123\n\n[4/5] Registering with delegator service...\n\u2705 Successfully registered with delegator service\n\ud83d\udce5 Requesting proof from delegator service...\n\u2705 Received delegator proof\n\n[5/5] Generating configuration file...\n\n\ud83c\udf89 Initialization complete! Your configuration:\n</code></pre> <p>The command creates a complete TOML configuration file. If you didn't save it to a file earlier, you can copy and save it now.</p>"},{"location":"setup/piri-server/#run-your-piri-node","title":"Run Your Piri Node","text":"<p>After setup is complete, run your Piri node using the configuration file:</p> <pre><code>piri serve --config=config.toml\n</code></pre> <p>If the <code>--config</code> option is not provided, Piri will automatically load config from your user config directory e.g. <code>~/.config/piri/config.toml</code>.</p> <p>Expected Output: <pre><code>\u2597\u2584\u2584\u2596 \u2584  \u2584\u2584\u2584 \u2584   \u2597\n\u2590\u258c \u2590\u258c\u2584 \u2588    \u2584   \u2588\u258c\n\u2590\u259b\u2580\u2598 \u2588 \u2588    \u2588  \u2597\u2588\u2598\n\u2590\u258c   \u2588      \u2588  \u2580\u2598\n\n\ud83d\udd25 v0.2.2\n\ud83c\udd94 did:key:z6MkhaXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX\nPiri Running on: localhost:3000\nPiri Public Endpoint: https://piri.example.com\n</code></pre></p>"},{"location":"setup/piri-server/#troubleshooting","title":"Troubleshooting","text":"<p>If you have problems, the Storacha team can help you in the Storacha Discord server.</p>"},{"location":"setup/piri-server/#initialization-issues","title":"Initialization Issues","text":"<p>If setup fails:</p> <ol> <li>Check your Lotus node is synced and can be reached</li> <li>Make sure your wallet has enough funds</li> <li>Check your public URL can be reached from the internet</li> <li>Check DNS is set up correctly for your domain</li> </ol>"},{"location":"setup/piri-server/#runtime-issues","title":"Runtime Issues","text":"<p>If the server won't start:</p> <ol> <li>Check that port 3000 is free to use</li> <li>Check all configuration values are correct</li> <li>Make sure the data and temp folders exist and you can write to them</li> <li>Check the wallet was imported correctly during setup</li> </ol> <p>Great work! Your Piri setup is done and ready to get data from the Storacha Network.</p>"},{"location":"setup/prerequisites/","title":"Prerequisites","text":"<p>This document outlines the common prerequisites for running Piri services. Specific services may have additional requirements noted in their respective guides.</p>"},{"location":"setup/prerequisites/#system-requirements","title":"System Requirements","text":""},{"location":"setup/prerequisites/#operating-system","title":"Operating System","text":"<ul> <li>Linux-based OS (Ubuntu 20.04+ recommended)</li> </ul>"},{"location":"setup/prerequisites/#hardware","title":"Hardware","text":"<ul> <li>CPU: 4+ cores</li> <li>RAM: 8+ GB</li> <li>Storage: 1+ TB</li> <li>Network: 1+ Gbps symmetric connection</li> </ul>"},{"location":"setup/prerequisites/#software-requirements","title":"Software Requirements","text":""},{"location":"setup/prerequisites/#required-packages","title":"Required Packages","text":"<p>Install the following packages:</p> <pre><code>sudo apt update &amp;&amp; \\\nsudo apt install -y make git jq curl wget nginx certbot python3-certbot-nginx\n</code></pre>"},{"location":"setup/prerequisites/#network-requirements","title":"Network Requirements","text":""},{"location":"setup/prerequisites/#domain","title":"Domain","text":"<p>You'll need a domain, e.g. <code>piri.example.com</code> </p>"},{"location":"setup/prerequisites/#firewall-configuration","title":"Firewall Configuration","text":"<p>Ensure the following ports are open for ingress and egress:</p> <ul> <li><code>80</code> </li> <li><code>443</code></li> </ul>"},{"location":"setup/prerequisites/#filecoin-prerequisites","title":"Filecoin Prerequisites","text":""},{"location":"setup/prerequisites/#lotus-node-setup","title":"Lotus Node Setup","text":"<p>A Lotus node is required for interacting with the PDP Smart Contract. Use the correct network for your environment:</p> Prod Use a mainnet Lotus node <ul> <li>Network: Mainnet</li> <li>Snapshot: Latest Mainnet Snapshot</li> <li>ETH RPC: Enable ETH RPC</li> <li>Endpoint: <code>wss://&lt;your-mainnet-lotus&gt;/rpc/v1</code></li> </ul> Staging Use a calibration Lotus node <ul> <li>Network: Calibration</li> <li>Snapshot: Latest Calibration Snapshot</li> <li>ETH RPC: Enable ETH RPC</li> <li>Endpoint: <code>wss://&lt;your-calib-lotus&gt;/rpc/v1</code></li> </ul>"},{"location":"setup/prerequisites/#funded-delegated-wallet","title":"Funded Delegated Wallet","text":"<p>A Lotus Delegated Address is required by Piri for interacting with the PDP Smart Contract. This guide assumes you have already setup a lotus node as described 'Filecoin Prerequisite' above. Please refer to the official Filecoin Docs for more details on delegated addresses.</p> <p>Step 1: Generate a Delegated Address</p> <pre><code>lotus wallet new delegated\n</code></pre> <p>Example output: <code>t410fzmmaqcn3j6jidbyrqqsvayejt6sskofwash6zoi</code></p> <p>Step 2: Fund the Address</p> Prod Fund with mainnet FIL <ol> <li>Send mainnet FIL to your delegated address (from your preferred wallet/exchange).</li> <li>Verify funding:</li> </ol> <pre><code>lotus wallet balance YOUR_DELEGATED_ADDRESS\n</code></pre> Staging Fund with calibration FIL <ol> <li>Visit the Calibration faucet</li> <li>Request funds for your new address</li> <li>Verify funding:</li> </ol> <pre><code>lotus wallet balance YOUR_DELEGATED_ADDRESS\n</code></pre>"},{"location":"setup/prerequisites/#next-steps","title":"Next Steps","text":"<p>Once you've completed all prerequisites:</p> <ul> <li>Install Piri</li> <li>Generate Cryptographic Keys</li> <li>Configure TLS Termination</li> </ul>"},{"location":"setup/tls-termination/","title":"TLS Termination","text":"<p>The Piri node does not handle TLS directly. For production use, you need a reverse proxy to handle secure HTTPS connections and send traffic from your domain to the Piri server.</p>"},{"location":"setup/tls-termination/#prerequisites","title":"Prerequisites","text":"<p>Before setting up TLS, make sure you have:</p> <ul> <li>\u2705 Completed system prerequisites (including domain setup)</li> <li>\u2705 Installed Piri</li> <li>\u2705 Generated cryptographic keys</li> </ul>"},{"location":"setup/tls-termination/#overview","title":"Overview","text":"<p>This section shows how your domain (from the Network Requirements) connects to your Piri server:</p> <pre><code>Internet \u2192 Your Domain \u2192 Nginx (HTTPS) \u2192 Piri Server (HTTP)\n         \u2193                   \u2193                \u2193\n   piri.example.com      Port 443        Port 3000\n</code></pre>"},{"location":"setup/tls-termination/#why-you-need-tls","title":"Why You Need TLS","text":"<ul> <li>Security: Protects data sent between clients and your server</li> <li>Trust: Needed for browsers and APIs to connect</li> <li>Network Requirements: Storacha Network needs HTTPS endpoints</li> <li>Certificate Management: Handles SSL certificates in one place</li> </ul>"},{"location":"setup/tls-termination/#dns-configuration","title":"DNS Configuration","text":"<p>Before you continue, make sure your domain points to your server:</p> <ol> <li>Set up a DNS A record for your domain that points to your server's IP address:</li> <li> <p><code>piri.example.com</code> \u2192 Your server IP</p> </li> <li> <p>Check DNS is working:    <pre><code>dig piri.example.com\n</code></pre></p> </li> </ol>"},{"location":"setup/tls-termination/#setting-up-nginx","title":"Setting up Nginx","text":"<p>Nginx works as a reverse proxy. It gets HTTPS connections on your domain and sends them to the Piri server running on your computer.</p>"},{"location":"setup/tls-termination/#prerequisites_1","title":"Prerequisites","text":"<pre><code># Install Nginx and Certbot\nsudo apt update\nsudo apt install -y nginx certbot python3-certbot-nginx\n</code></pre>"},{"location":"setup/tls-termination/#setup-steps","title":"Setup Steps","text":"<p>Step 1: Create Configuration File</p> <p>Make a configuration file for your domain: - <code>/etc/nginx/sites-available/piri.example.com</code></p> <p>Step 2: Set Up Piri Server (piri.example.com \u2192 Port 3000)</p> <p>Create the file <code>/etc/nginx/sites-available/piri.example.com</code>:</p> <pre><code>server {\n    server_name piri.example.com;  # Replace with your actual domain\n\n    # Piri server handles file uploads and storage\n    client_max_body_size 0;           # Allow any file size\n    client_body_timeout 300s;         # Wait time for slow uploads\n    client_header_timeout 300s;       # Wait time for slow connections\n    send_timeout 300s;                # Wait time for sending responses\n\n    location / {\n        proxy_pass http://localhost:3000;\n        proxy_http_version 1.1;\n        proxy_set_header Upgrade $http_upgrade;\n        proxy_set_header Connection 'upgrade';\n        proxy_set_header Host $host;\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header X-Forwarded-Proto $scheme;\n        proxy_cache_bypass $http_upgrade;\n\n        proxy_request_buffering off; # Send uploads directly to Piri\n    }\n}\n</code></pre> <p>Step 3: Enable the Site</p> <p>Turn on the nginx configuration:</p> <pre><code># Enable Piri server configuration\nsudo ln -s /etc/nginx/sites-available/piri.example.com /etc/nginx/sites-enabled/\n\n# Test configuration\nsudo nginx -t\n\n# Reload nginx\nsudo systemctl reload nginx\n</code></pre> <p>Step 4: Obtain SSL Certificate</p> <p>Get an SSL certificate for your domain:</p> <pre><code># Replace with your actual domain\nsudo certbot --nginx -d piri.example.com\n</code></pre>"},{"location":"setup/tls-termination/#port-configuration","title":"Port Configuration","text":"<p>Default ports:</p> <ul> <li>Piri Server: 3000 (can change with <code>--port</code> or config file)</li> <li>HTTPS: 443 (standard secure port)</li> <li>HTTP: 80 (redirects to HTTPS)</li> </ul>"},{"location":"setup/tls-termination/#testing-your-configuration","title":"Testing Your Configuration","text":"<p>After setting up TLS, check that HTTPS works for your domain:</p> <pre><code># Test your domain\ncurl -I https://piri.example.com\n</code></pre> <p>This should show HTTP status 502 (Bad Gateway) until you start the Piri server.</p>"},{"location":"setup/tls-termination/#next-steps","title":"Next Steps","text":"<p>After setting up TLS, continue to:</p> <ul> <li>Setup Piri Node</li> </ul>"}]}